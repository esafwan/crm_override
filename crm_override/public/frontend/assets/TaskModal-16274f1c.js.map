{"version":3,"file":"TaskModal-16274f1c.js","sources":["../../../../frontend/src/components/Modals/TaskModal.vue"],"sourcesContent":["<template>\n  <Dialog\n    v-model=\"show\"\n    :options=\"{\n      size: 'xl',\n      actions: [\n        {\n          label: editMode ? __('Update') : __('Create'),\n          variant: 'solid',\n          onClick: () => updateTask(),\n        },\n      ],\n    }\"\n  >\n    <template #body-title>\n      <div class=\"flex items-center gap-3\">\n        <h3 class=\"text-2xl font-semibold leading-6 text-gray-900\">\n          {{ editMode ? __('Edit Task') : __('Create Task') }}\n        </h3>\n        <Button\n          v-if=\"task?.reference_docname\"\n          variant=\"outline\"\n          size=\"sm\"\n          :label=\"\n            task.reference_doctype == 'CRM Deal'\n              ? __('Open Deal')\n              : __('Open Lead')\n          \"\n          @click=\"redirect()\"\n        >\n          <template #suffix>\n            <ArrowUpRightIcon class=\"h-4 w-4\" />\n          </template>\n        </Button>\n      </div>\n    </template>\n    <template #body-content>\n      <div class=\"flex flex-col gap-4\">\n        <div>\n          <div class=\"mb-1.5 text-sm text-gray-600\">{{ __('Title') }}</div>\n          <TextInput\n            ref=\"title\"\n            variant=\"outline\"\n            v-model=\"_task.title\"\n            :placeholder=\"__('Call with John Doe')\"\n          />\n        </div>\n        <div>\n          <div class=\"mb-1.5 text-sm text-gray-600\">\n            {{ __('Description') }}\n          </div>\n          <TextEditor\n            variant=\"outline\"\n            ref=\"description\"\n            editor-class=\"!prose-sm overflow-auto min-h-[80px] max-h-80 py-1.5 px-2 rounded border border-gray-300 bg-white hover:border-gray-400 hover:shadow-sm focus:bg-white focus:border-gray-500 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-gray-400 text-gray-800 transition-colors\"\n            :bubbleMenu=\"true\"\n            :content=\"_task.description\"\n            @change=\"(val) => (_task.description = val)\"\n            :placeholder=\"\n              __('Took a call with John Doe and discussed the new project.')\n            \"\n          />\n        </div>\n        <div class=\"flex flex-wrap items-center gap-2\">\n          <Dropdown :options=\"taskStatusOptions(updateTaskStatus)\">\n            <Button :label=\"_task.status\" class=\"w-full justify-between\">\n              <template #prefix>\n                <TaskStatusIcon :status=\"_task.status\" />\n              </template>\n            </Button>\n          </Dropdown>\n          <Link\n            class=\"form-control\"\n            :value=\"getUser(_task.assigned_to).full_name\"\n            doctype=\"User\"\n            @change=\"(option) => (_task.assigned_to = option)\"\n            :placeholder=\"__('John Doe')\"\n            :hideMe=\"true\"\n          >\n            <template #prefix>\n              <UserAvatar class=\"mr-2 !h-4 !w-4\" :user=\"_task.assigned_to\" />\n            </template>\n            <template #item-prefix=\"{ option }\">\n              <UserAvatar class=\"mr-2\" :user=\"option.value\" size=\"sm\" />\n            </template>\n            <template #item-label=\"{ option }\">\n              <Tooltip :text=\"option.value\">\n                <div class=\"cursor-pointer\">\n                  {{ getUser(option.value).full_name }}\n                </div>\n              </Tooltip>\n            </template>\n          </Link>\n          <DateTimePicker\n            class=\"datepicker w-36\"\n            v-model=\"_task.due_date\"\n            :placeholder=\"__('01/04/2024 11:30 PM')\"\n            input-class=\"border-none\"\n          />\n          <Dropdown :options=\"taskPriorityOptions(updateTaskPriority)\">\n            <Button :label=\"_task.priority\" class=\"w-full justify-between\">\n              <template #prefix>\n                <TaskPriorityIcon :priority=\"_task.priority\" />\n              </template>\n            </Button>\n          </Dropdown>\n        </div>\n      </div>\n    </template>\n  </Dialog>\n</template>\n\n<script setup>\nimport TaskStatusIcon from '@/components/Icons/TaskStatusIcon.vue'\nimport TaskPriorityIcon from '@/components/Icons/TaskPriorityIcon.vue'\nimport ArrowUpRightIcon from '@/components/Icons/ArrowUpRightIcon.vue'\nimport UserAvatar from '@/components/UserAvatar.vue'\nimport Link from '@/components/Controls/Link.vue'\nimport { taskStatusOptions, taskPriorityOptions } from '@/utils'\nimport { usersStore } from '@/stores/users'\nimport { capture } from '@/telemetry'\nimport { TextEditor, Dropdown, Tooltip, call, DateTimePicker } from 'frappe-ui'\nimport { ref, watch, nextTick, onMounted } from 'vue'\nimport { useRouter } from 'vue-router'\n\nconst props = defineProps({\n  task: {\n    type: Object,\n    default: {},\n  },\n  doctype: {\n    type: String,\n    default: 'CRM Lead',\n  },\n  doc: {\n    type: String,\n    default: '',\n  },\n})\n\nconst show = defineModel()\nconst tasks = defineModel('reloadTasks')\n\nconst emit = defineEmits(['updateTask'])\n\nconst router = useRouter()\nconst { getUser } = usersStore()\n\nconst title = ref(null)\nconst editMode = ref(false)\nconst _task = ref({\n  title: '',\n  description: '',\n  assigned_to: '',\n  due_date: '',\n  status: 'Backlog',\n  priority: 'Low',\n  reference_doctype: props.doctype,\n  reference_docname: null,\n})\n\nfunction updateTaskStatus(status) {\n  _task.value.status = status\n}\n\nfunction updateTaskPriority(priority) {\n  _task.value.priority = priority\n}\n\nfunction redirect() {\n  if (!props.task?.reference_docname) return\n  let name = props.task.reference_doctype == 'CRM Deal' ? 'Deal' : 'Lead'\n  let params = { leadId: props.task.reference_docname }\n  if (name == 'Deal') {\n    params = { dealId: props.task.reference_docname }\n  }\n  router.push({ name: name, params: params })\n}\n\nasync function updateTask() {\n  if (!_task.value.assigned_to) {\n    _task.value.assigned_to = getUser().name\n  }\n  if (_task.value.name) {\n    let d = await call('frappe.client.set_value', {\n      doctype: 'CRM Task',\n      name: _task.value.name,\n      fieldname: _task.value,\n    })\n    if (d.name) {\n      tasks.value.reload()\n    }\n  } else {\n    let d = await call('frappe.client.insert', {\n      doc: {\n        doctype: 'CRM Task',\n        reference_doctype: props.doctype,\n        reference_docname: props.doc || null,\n        ..._task.value,\n      },\n    })\n    if (d.name) {\n      capture('task_created')\n      tasks.value.reload()\n    }\n  }\n  show.value = false\n}\n\nfunction render() {\n  editMode.value = false\n  nextTick(() => {\n    title.value?.el?.focus?.()\n    _task.value = { ...props.task }\n    if (_task.value.title) {\n      editMode.value = true\n    }\n  })\n}\n\nonMounted(() => show.value && render())\n\nwatch(show, (value) => {\n  if (!value) return\n  render()\n})\n</script>\n\n<style scoped>\n:deep(.datepicker svg) {\n  width: 0.875rem;\n  height: 0.875rem;\n}\n</style>\n"],"names":["props","__props","show","_useModel","tasks","router","useRouter","getUser","usersStore","title","ref","editMode","_task","updateTaskStatus","status","updateTaskPriority","priority","redirect","_a","name","params","updateTask","call","capture","render","nextTick","_c","_b","onMounted","watch","value"],"mappings":"28BA6HA,MAAMA,EAAQC,EAeRC,EAAOC,gBAAY,EACnBC,EAAQD,EAAYF,EAAA,aAAa,EAIjCI,EAASC,EAAW,EACpB,CAAE,QAAAC,CAAS,EAAGC,EAAY,EAE1BC,EAAQC,EAAI,IAAI,EAChBC,EAAWD,EAAI,EAAK,EACpBE,EAAQF,EAAI,CAChB,MAAO,GACP,YAAa,GACb,YAAa,GACb,SAAU,GACV,OAAQ,UACR,SAAU,MACV,kBAAmBV,EAAM,QACzB,kBAAmB,IACrB,CAAC,EAED,SAASa,EAAiBC,EAAQ,CAChCF,EAAM,MAAM,OAASE,CACvB,CAEA,SAASC,EAAmBC,EAAU,CACpCJ,EAAM,MAAM,SAAWI,CACzB,CAEA,SAASC,GAAW,OAClB,GAAI,GAACC,EAAAlB,EAAM,OAAN,MAAAkB,EAAY,mBAAmB,OACpC,IAAIC,EAAOnB,EAAM,KAAK,mBAAqB,WAAa,OAAS,OAC7DoB,EAAS,CAAE,OAAQpB,EAAM,KAAK,iBAAmB,EACjDmB,GAAQ,SACVC,EAAS,CAAE,OAAQpB,EAAM,KAAK,iBAAmB,GAEnDK,EAAO,KAAK,CAAE,KAAMc,EAAM,OAAQC,EAAQ,CAC5C,CAEA,eAAeC,GAAa,CACrBT,EAAM,MAAM,cACfA,EAAM,MAAM,YAAcL,EAAS,EAAC,MAElCK,EAAM,MAAM,MACN,MAAMU,EAAK,0BAA2B,CAC5C,QAAS,WACT,KAAMV,EAAM,MAAM,KAClB,UAAWA,EAAM,KACvB,CAAK,GACK,MACJR,EAAM,MAAM,OAAQ,GAGd,MAAMkB,EAAK,uBAAwB,CACzC,IAAK,CACH,QAAS,WACT,kBAAmBtB,EAAM,QACzB,kBAAmBA,EAAM,KAAO,KAChC,GAAGY,EAAM,KACV,CACP,CAAK,GACK,OACJW,EAAQ,cAAc,EACtBnB,EAAM,MAAM,OAAQ,GAGxBF,EAAK,MAAQ,EACf,CAEA,SAASsB,GAAS,CAChBb,EAAS,MAAQ,GACjBc,EAAS,IAAM,YACbC,GAAAC,GAAAT,EAAAT,EAAM,QAAN,YAAAS,EAAa,KAAb,YAAAS,EAAiB,QAAjB,MAAAD,EAAA,KAAAC,GACAf,EAAM,MAAQ,CAAE,GAAGZ,EAAM,IAAM,EAC3BY,EAAM,MAAM,QACdD,EAAS,MAAQ,GAEvB,CAAG,CACH,CAEA,OAAAiB,EAAU,IAAM1B,EAAK,OAASsB,GAAQ,EAEtCK,EAAM3B,EAAO4B,GAAU,CAChBA,GACLN,EAAQ,CACV,CAAC"}