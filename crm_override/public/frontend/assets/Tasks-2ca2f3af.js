import{m as q,i as K,j as P,s as X,k as Z,l as h,r as B,b as o,c as n,d as s,w as r,u as p,F as D,f as O,g as b,n as J,p as v,e as x,t as $,q as W,v as N,I as ee}from"./index-82d0b844.js";import{_ as te,a as oe}from"./ViewControls-4c2465f0.js";import{_ as se}from"./CustomActions-d045e678.js";import{A as ae}from"./ArrowUpRightIcon-60e3a514.js";import{_ as I,d as j,n as S,m as H,b as Y,u as le,t as ne,c as ie}from"./index-8340263f.js";import{E as re}from"./Email2Icon-c181bc5b.js";import{_ as ue}from"./LayoutHeader-ce3efb9b.js";import{_ as de,H as G,a as ce,f as pe,b as me,g as fe,c as _e,d as ke,e as ve}from"./ListBulkActions-6a63e81f.js";import{C as ye}from"./CalendarIcon-5c294322.js";import{D as Q}from"./Dropdown-f8d4a8c8.js";import{_ as ge}from"./ListFooter-621c0d06.js";import{_ as be}from"./KanbanView-6155680d.js";import{T as Ce}from"./TaskModal-16274f1c.js";import{T as we}from"./views-5c6870e6.js";import"./GroupByIcon-584f979a.js";import"./Dropdown-57634c86.js";import"./NestedPopover-9b04b27b.js";import"./EditIcon-3c54f763.js";import"./PinIcon-d3dd27b0.js";import"./FadedScrollableDiv-5302c81a.js";import"./settings-6089b88c.js";import"./DetailsIcon-f2258ff1.js";import"./DragVerticalIcon-71ed262e.js";import"./AssignmentModal-a088aaa9.js";import"./label-16764775.js";import"./IndicatorIcon-d1b8f59f.js";const he={key:0},xe={class:"flex items-center gap-2 truncate text-base"},$e={key:0,class:"truncate"},Me={key:0},Ve={key:1},Te={key:2},Le=["onClick"],Ue=["innerHTML"],Ae={key:2},ze={key:3},Re=["onClick"],De={__name:"TasksListView",props:q({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:q(["loadMore","updatePageCount","showTask","columnWidthUpdated","applyFilter","applyLikeFilter","likeDoc"],["update:modelValue","update:list"]),setup(y,{expose:R,emit:E}){const C=E,i=K(y,"modelValue"),T=K(y,"list"),U=P(()=>{var _,k;return!!((k=(_=T.value.params)==null?void 0:_.filters)!=null&&k._liked_by)}),{user:A}=X();function w(_){if(_)return JSON.parse(_).includes(A)}Z(i,(_,k)=>{_!==k&&C("updatePageCount",_)});const a=h(null);return R({customListActions:P(()=>{var _;return(_=a.value)==null?void 0:_.customListActions})}),(_,k)=>{const L=B("Button"),M=B("FormControl");return o(),n(D,null,[s(p(ke),{columns:y.columns,rows:y.rows,options:{onRowClick:u=>C("showTask",u.name),selectable:y.options.selectable,showTooltip:y.options.showTooltip,resizeColumn:y.options.resizeColumn},"row-key":"name"},{default:r(()=>[s(p(de),{class:"mx-3 sm:mx-5",onColumnWidthUpdated:k[1]||(k[1]=u=>C("columnWidthUpdated"))},{default:r(()=>[(o(!0),n(D,null,O(y.columns,u=>(o(),b(p(ce),{key:u.key,item:u,onColumnWidthUpdated:V=>C("columnWidthUpdated",u)},{default:r(()=>[u.key=="_liked_by"?(o(),b(L,{key:0,variant:"ghosted",class:J(["!h-4",U.value?"fill-red-500":"fill-white"]),onClick:k[0]||(k[0]=()=>C("applyLikeFilter"))},{default:r(()=>[s(G,{class:"h-4 w-4"})]),_:1},8,["class"])):v("",!0)]),_:2},1032,["item","onColumnWidthUpdated"]))),128))]),_:1}),s(p(pe),{class:"mx-3 sm:mx-5",id:"list-rows"},{default:r(()=>[(o(!0),n(D,null,O(y.rows,u=>(o(),b(p(fe),{key:u.name,row:u},{default:r(({idx:V,column:g,item:m})=>[g.key==="due_date"?(o(),n("div",he,[s(p(I),{text:p(j)(m,"ddd, MMM D, YYYY | hh:mm a")},{default:r(()=>[x("div",xe,[s(ye),m?(o(),n("div",$e,$(p(j)(m,"D MMM, hh:mm a")),1)):v("",!0)])]),_:2},1032,["text"])])):(o(),b(p(me),{key:1,item:m},{prefix:r(()=>[g.key==="status"?(o(),n("div",Me,[s(S,{status:m},null,8,["status"])])):g.key==="priority"?(o(),n("div",Ve,[s(H,{priority:m},null,8,["priority"])])):g.key==="assigned_to"?(o(),n("div",Te,[m.full_name?(o(),b(p(Y),{key:0,class:"flex items-center",image:m.user_image,label:m.full_name,size:"sm"},null,8,["image","label"])):v("",!0)])):v("",!0)]),default:r(({label:F})=>[["modified","creation"].includes(g.key)?(o(),n("div",{key:0,class:"truncate text-base",onClick:z=>C("applyFilter",{event:z,idx:V,column:g,item:m,firstColumn:y.columns[0]})},[s(p(I),{text:m.label},{default:r(()=>[x("div",null,$(m.timeAgo),1)]),_:2},1032,["text"])],8,Le)):g.type==="Text Editor"?(o(),n("div",{key:1,innerHTML:m,class:"truncate text-base h-4 [&>p]:truncate"},null,8,Ue)):g.type==="Check"?(o(),n("div",Ae,[s(M,{type:"checkbox",modelValue:m,disabled:!0,class:"text-gray-900"},null,8,["modelValue"])])):g.key==="_liked_by"?(o(),n("div",ze,[g.key=="_liked_by"?(o(),b(L,{key:0,variant:"ghosted",class:J(w(m)?"fill-red-500":"fill-white"),onClick:W(()=>C("likeDoc",{name:u.name,liked:w(m)}),["stop","prevent"])},{default:r(()=>[s(G,{class:"h-4 w-4"})]),_:2},1032,["class","onClick"])):v("",!0)])):(o(),n("div",{key:4,class:"truncate text-base",onClick:z=>C("applyFilter",{event:z,idx:V,column:g,item:m,firstColumn:y.columns[0]})},$(F),9,Re))]),_:2},1032,["item"]))]),_:2},1032,["row"]))),128))]),_:1}),s(p(_e),null,{actions:r(({selections:u,unselectAll:V})=>[s(p(Q),{options:a.value.bulkActions(u,V)},{default:r(()=>[s(L,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])]),_:1})]),_:1},8,["columns","rows","options"]),s(p(ge),{class:"border-t px-3 py-2 sm:px-5",modelValue:i.value,"onUpdate:modelValue":k[2]||(k[2]=u=>i.value=u),options:{rowCount:y.options.rowCount,totalCount:y.options.totalCount},onLoadMore:k[3]||(k[3]=u=>C("loadMore"))},null,8,["modelValue","options"]),s(ve,{ref_key:"listBulkActionsRef",ref:a,modelValue:T.value,"onUpdate:modelValue":k[4]||(k[4]=u=>T.value=u),doctype:"CRM Task",options:{hideAssign:!0}},null,8,["modelValue"])],64)}}},Be={class:"flex items-center gap-2"},Ie={key:0},Ee={key:1},Fe={key:2},Pe={key:3,class:"truncate text-base"},We={key:4,class:"truncate text-base"},je={key:5,class:"text-gray-500"},Se={key:0,class:"truncate flex items-center gap-2"},He={key:0},Ye={key:1},qe={key:2},Ke={key:3,class:"truncate text-base"},Oe={key:4,class:"truncate text-base max-h-44"},Je={key:5,class:"truncate text-base"},Ge={class:"flex gap-2 items-center justify-between"},Qe={key:2,class:"flex h-full items-center justify-center"},Xe={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},xt={__name:"Tasks",setup(y){const{getUser:R}=le(),E=N(),C=h(null),i=h({}),T=h(1),U=h(1),A=h(20),w=h(null);function a(l,t){var f;function d(e){return e&&typeof e=="object"?e:{label:e}}return d((f=_.value)==null?void 0:f.find(e=>e.name==l)[t])}const _=P(()=>{var l,t,d;return(t=(l=i.value)==null?void 0:l.data)!=null&&t.data?i.value.data.view_type==="kanban"?k(i.value.data.data):L((d=i.value)==null?void 0:d.data.data):[]});function k(l){let t=[];return l.forEach(d=>{var f;(f=d.data)==null||f.forEach(e=>{t.push(e)})}),L(t)}function L(l){return l.map(t=>{var f;let d={};return(f=i.value)==null||f.data.rows.forEach(e=>{d[e]=t[e],["modified","creation"].includes(e)?d[e]={label:j(t[e],ie),timeAgo:__(ne(t[e]))}:e=="assigned_to"&&(d[e]={label:t.assigned_to&&R(t.assigned_to).full_name,...t.assigned_to&&R(t.assigned_to)})}),d})}const M=h(!1),u=h({name:"",title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:"CRM Lead",reference_docname:""});function V(l){var d,f;let t=(d=_.value)==null?void 0:d.find(e=>e.name===l);u.value={name:t.name,title:t.title,description:t.description,assigned_to:((f=t.assigned_to)==null?void 0:f.email)||"",due_date:t.due_date,status:t.status,priority:t.priority,reference_doctype:t.reference_doctype,reference_docname:t.reference_docname},M.value=!0}function g(l){var t;if(u.value={name:"",title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:"CRM Lead",reference_docname:""},(t=l.column)!=null&&t.name){let d=i.value.params.column_field;d&&(u.value[d]=l.column.name)}M.value=!0}function m(l){return[{label:__("Delete"),icon:"trash-2",onClick:()=>{F(l),i.value.reload()}}]}async function F(l){await ee("frappe.client.delete",{doctype:"CRM Task",name:l})}function z(l,t){if(!t)return;let d=l=="CRM Deal"?"Deal":"Lead",f={leadId:t};d=="Deal"&&(f={dealId:t}),E.push({name:d,params:f})}return(l,t)=>{const d=B("FeatherIcon"),f=B("Button");return o(),n(D,null,[s(ue,null,{"left-header":r(()=>[s(oe,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=e=>w.value=e),routeName:"Tasks"},null,8,["modelValue"])]),"right-header":r(()=>{var e;return[(e=C.value)!=null&&e.customListActions?(o(),b(se,{key:0,actions:C.value.customListActions},null,8,["actions"])):v("",!0),s(f,{variant:"solid",label:l.__("Create"),onClick:g},{prefix:r(()=>[s(d,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),s(te,{ref_key:"viewControls",ref:w,modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),loadMore:T.value,"onUpdate:loadMore":t[2]||(t[2]=e=>T.value=e),resizeColumn:U.value,"onUpdate:resizeColumn":t[3]||(t[3]=e=>U.value=e),updatedPageCount:A.value,"onUpdate:updatedPageCount":t[4]||(t[4]=e=>A.value=e),doctype:"CRM Task",options:{allowedViews:["list","kanban"]}},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),l.$route.params.viewType=="kanban"&&_.value.length?(o(),b(be,{key:0,modelValue:i.value,"onUpdate:modelValue":t[6]||(t[6]=e=>i.value=e),options:{onClick:e=>V(e.name),onNewClick:e=>g(e)},onUpdate:t[7]||(t[7]=e=>w.value.updateKanbanSettings(e)),onLoadMore:t[8]||(t[8]=e=>w.value.loadMoreKanban(e))},{title:r(({titleField:e,itemName:c})=>[x("div",Be,[e==="status"?(o(),n("div",Ie,[s(S,{status:a(c,e).label},null,8,["status"])])):e==="priority"?(o(),n("div",Ee,[s(H,{priority:a(c,e).label},null,8,["priority"])])):e==="assigned_to"?(o(),n("div",Fe,[a(c,e).full_name?(o(),b(p(Y),{key:0,class:"flex items-center",image:a(c,e).user_image,label:a(c,e).full_name,size:"sm"},null,8,["image","label"])):v("",!0)])):v("",!0),["modified","creation"].includes(e)?(o(),n("div",Pe,[s(p(I),{text:a(c,e).label},{default:r(()=>[x("div",null,$(a(c,e).timeAgo),1)]),_:2},1032,["text"])])):a(c,e).label?(o(),n("div",We,$(a(c,e).label),1)):(o(),n("div",je,$(l.__("No Title")),1))])]),fields:r(({fieldName:e,itemName:c})=>[a(c,e).label?(o(),n("div",Se,[e==="status"?(o(),n("div",He,[s(S,{class:"size-3",status:a(c,e).label},null,8,["status"])])):e==="priority"?(o(),n("div",Ye,[s(H,{priority:a(c,e).label},null,8,["priority"])])):e==="assigned_to"?(o(),n("div",qe,[a(c,e).full_name?(o(),b(p(Y),{key:0,class:"flex items-center",image:a(c,e).user_image,label:a(c,e).full_name,size:"sm"},null,8,["image","label"])):v("",!0)])):v("",!0),["modified","creation"].includes(e)?(o(),n("div",Ke,[s(p(I),{text:a(c,e).label},{default:r(()=>[x("div",null,$(a(c,e).timeAgo),1)]),_:2},1032,["text"])])):e=="description"?(o(),n("div",Oe,[a(c,e).label?(o(),b(p(we),{key:0,content:a(c,e).label,editable:!1,"editor-class":"!prose-sm max-w-none focus:outline-none",class:"flex-1 overflow-hidden"},null,8,["content"])):v("",!0)])):(o(),n("div",Je,$(a(c,e).label),1))])):v("",!0)]),actions:r(({itemName:e})=>[x("div",Ge,[x("div",null,[a(e,"reference_docname").label?(o(),b(f,{key:0,class:"-ml-2",variant:"ghost",size:"sm",label:a(e,"reference_doctype").label=="CRM Deal"?l.__("Deal"):l.__("Lead"),onClick:W(c=>z(a(e,"reference_doctype").label,a(e,"reference_docname").label),["stop"])},{suffix:r(()=>[s(ae,{class:"h-4 w-4"})]),_:2},1032,["label","onClick"])):v("",!0)]),s(p(Q),{class:"flex items-center gap-2",options:m(e),variant:"ghost",onClick:t[5]||(t[5]=W(()=>{},["stop","prevent"]))},{default:r(()=>[s(f,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])])]),_:1},8,["modelValue","options"])):i.value.data&&_.value.length?(o(),b(De,{key:1,ref_key:"tasksListView",ref:C,modelValue:i.value.data.page_length_count,"onUpdate:modelValue":t[9]||(t[9]=e=>i.value.data.page_length_count=e),list:i.value,"onUpdate:list":t[10]||(t[10]=e=>i.value=e),rows:_.value,columns:i.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:i.value.data.row_count,totalCount:i.value.data.total_count},onLoadMore:t[11]||(t[11]=()=>T.value++),onColumnWidthUpdated:t[12]||(t[12]=()=>U.value++),onUpdatePageCount:t[13]||(t[13]=e=>A.value=e),onShowTask:V,onApplyFilter:t[14]||(t[14]=e=>w.value.applyFilter(e)),onApplyLikeFilter:t[15]||(t[15]=e=>w.value.applyLikeFilter(e)),onLikeDoc:t[16]||(t[16]=e=>w.value.likeDoc(e))},null,8,["modelValue","list","rows","columns","options"])):i.value.data?(o(),n("div",Qe,[x("div",Xe,[s(re,{class:"h-10 w-10"}),x("span",null,$(l.__("No {0} Found",[l.__("Tasks")])),1),s(f,{label:l.__("Create"),onClick:t[17]||(t[17]=e=>M.value=!0)},{prefix:r(()=>[s(d,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):v("",!0),M.value?(o(),b(Ce,{key:3,modelValue:M.value,"onUpdate:modelValue":t[18]||(t[18]=e=>M.value=e),reloadTasks:i.value,"onUpdate:reloadTasks":t[19]||(t[19]=e=>i.value=e),task:u.value},null,8,["modelValue","reloadTasks","task"])):v("",!0)],64)}}};export{xt as default};
//# sourceMappingURL=Tasks-2ca2f3af.js.map
