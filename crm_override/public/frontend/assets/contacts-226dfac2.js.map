{"version":3,"file":"contacts-226dfac2.js","sources":["../../../../frontend/src/stores/contacts.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { createResource } from 'frappe-ui'\nimport { reactive } from 'vue'\n\nexport const contactsStore = defineStore('crm-contacts', () => {\n  let contactsByPhone = reactive({})\n  let contactsByName = reactive({})\n  let leadContactsByPhone = reactive({})\n  let allContacts = reactive([])\n\n  const contacts = createResource({\n    url: 'crm.api.session.get_contacts',\n    cache: 'contacts',\n    initialData: [],\n    auto: true,\n    transform(contacts) {\n      for (let contact of contacts) {\n        // remove special characters from phone number to make it easier to search\n        // also remove spaces but keep + sign at the start\n        contact.actual_mobile_no = contact.mobile_no\n        contact.mobile_no = contact.mobile_no?.replace(/[^0-9+]/g, '')\n        contactsByPhone[contact.mobile_no] = contact\n        contactsByName[contact.name] = contact\n      }\n      allContacts = [...contacts]\n      return contacts\n    },\n    onError(error) {\n      if (error && error.exc_type === 'AuthenticationError') {\n        router.push('/login')\n      }\n    },\n  })\n\n  const leadContacts = createResource({\n    url: 'crm.api.session.get_lead_contacts',\n    cache: 'lead_contacts',\n    initialData: [],\n    auto: true,\n    transform(lead_contacts) {\n      for (let lead_contact of lead_contacts) {\n        // remove special characters from phone number to make it easier to search\n        // also remove spaces but keep + sign at the start\n        lead_contact.mobile_no = lead_contact.mobile_no?.replace(/[^0-9+]/g, '')\n        lead_contact.full_name = lead_contact.lead_name\n        leadContactsByPhone[lead_contact.mobile_no] = lead_contact\n      }\n      return lead_contacts\n    },\n    onError(error) {\n      if (error && error.exc_type === 'AuthenticationError') {\n        router.push('/login')\n      }\n    },\n  })\n\n  function getContact(mobile_no) {\n    mobile_no = mobile_no?.replace(/[^0-9+]/g, '')\n    return contactsByPhone[mobile_no]\n  }\n  function getContactByName(name) {\n    return contactsByName[name]\n  }\n  function getLeadContact(mobile_no) {\n    mobile_no = mobile_no?.replace(/[^0-9+]/g, '')\n    return leadContactsByPhone[mobile_no]\n  }\n\n  function getContacts() {\n    return allContacts || contacts?.data || []\n  }\n\n  return {\n    contacts,\n    getContacts,\n    getContact,\n    getContactByName,\n    getLeadContact,\n  }\n})\n"],"names":["contactsStore","defineStore","contactsByPhone","reactive","contactsByName","leadContactsByPhone","allContacts","contacts","createResource","contact","_a","error","lead_contacts","lead_contact","getContact","mobile_no","getContactByName","name","getLeadContact","getContacts"],"mappings":"uDAIY,MAACA,EAAgBC,EAAY,eAAgB,IAAM,CAC7D,IAAIC,EAAkBC,EAAS,EAAE,EAC7BC,EAAiBD,EAAS,EAAE,EAC5BE,EAAsBF,EAAS,EAAE,EACjCG,EAAcH,EAAS,EAAE,EAE7B,MAAMI,EAAWC,EAAe,CAC9B,IAAK,+BACL,MAAO,WACP,YAAa,CAAE,EACf,KAAM,GACN,UAAUD,EAAU,OAClB,QAASE,KAAWF,EAGlBE,EAAQ,iBAAmBA,EAAQ,UACnCA,EAAQ,WAAYC,EAAAD,EAAQ,YAAR,YAAAC,EAAmB,QAAQ,WAAY,IAC3DR,EAAgBO,EAAQ,SAAS,EAAIA,EACrCL,EAAeK,EAAQ,IAAI,EAAIA,EAEjC,OAAAH,EAAc,CAAC,GAAGC,CAAQ,EACnBA,CACR,EACD,QAAQI,EAAO,CACTA,GAASA,EAAM,WAAa,uBAC9B,OAAO,KAAK,QAAQ,CAEvB,CACL,CAAG,EAEoBH,EAAe,CAClC,IAAK,oCACL,MAAO,gBACP,YAAa,CAAE,EACf,KAAM,GACN,UAAUI,EAAe,OACvB,QAASC,KAAgBD,EAGvBC,EAAa,WAAYH,EAAAG,EAAa,YAAb,YAAAH,EAAwB,QAAQ,WAAY,IACrEG,EAAa,UAAYA,EAAa,UACtCR,EAAoBQ,EAAa,SAAS,EAAIA,EAEhD,OAAOD,CACR,EACD,QAAQD,EAAO,CACTA,GAASA,EAAM,WAAa,uBAC9B,OAAO,KAAK,QAAQ,CAEvB,CACL,CAAG,EAED,SAASG,EAAWC,EAAW,CAC7B,OAAAA,EAAYA,GAAA,YAAAA,EAAW,QAAQ,WAAY,IACpCb,EAAgBa,CAAS,CACjC,CACD,SAASC,EAAiBC,EAAM,CAC9B,OAAOb,EAAea,CAAI,CAC3B,CACD,SAASC,EAAeH,EAAW,CACjC,OAAAA,EAAYA,GAAA,YAAAA,EAAW,QAAQ,WAAY,IACpCV,EAAoBU,CAAS,CACrC,CAED,SAASI,GAAc,CACrB,OAAOb,IAAeC,GAAA,YAAAA,EAAU,OAAQ,CAAE,CAC3C,CAED,MAAO,CACL,SAAAA,EACA,YAAAY,EACA,WAAAL,EACA,iBAAAE,EACA,eAAAE,CACD,CACH,CAAC"}