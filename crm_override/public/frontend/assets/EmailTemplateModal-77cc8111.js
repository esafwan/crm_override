import{m as C,i as M,l as u,k as S,r as c,b,g,w as I,e as o,H as T,t as v,d as s,u as t,a6 as q,a7 as k,I as V,z as B,A as O}from"./index-82d0b844.js";import{T as z}from"./views-5c6870e6.js";const H={class:"flex flex-col gap-4"},J={class:"flex sm:flex-row flex-col gap-4"},L={class:"flex-1"},P={class:"mb-1.5 text-sm text-gray-600"},$={class:"flex-1"},A={class:"mb-1.5 text-sm text-gray-600"},G={class:"mb-1.5 text-sm text-gray-600"},K={class:"mb-1.5 text-sm text-gray-600"},Y={__name:"EmailTemplateModal",props:C({emailTemplate:{type:Object,default:{}}},{modelValue:{},modelModifiers:{},reloadEmailTemplates:{},reloadEmailTemplatesModifiers:{}}),emits:C(["after"],["update:modelValue","update:reloadEmailTemplates"]),setup(p,{emit:Q}){const _=p,r=M(p,"modelValue"),D=M(p,"reloadEmailTemplates"),m=u(""),h=u(null),w=u(null),i=u(!1);let l=u({});async function R(){if(!E())return;const a={..._.emailTemplate},e={...l.value},d=a.name!==e.name;delete a.name,delete e.name;const f=JSON.stringify(a)!==JSON.stringify(e),y=e;if(!d&&!f){r.value=!1;return}d&&await U(),f&&await j(y),x()}async function U(){return await V("frappe.client.rename_doc",{doctype:"Email Template",old_name:_.emailTemplate.name,new_name:l.value.name})}async function j(a){return(await V("frappe.client.set_value",{doctype:"Email Template",name:l.value.name,fieldname:a})).name}async function N(){if(!E())return;const a=await V("frappe.client.insert",{doc:{doctype:"Email Template",...l.value}});a.name&&(B("email_template_created",{doctype:a.reference_doctype}),x())}function x(a){var e;(e=D.value)==null||e.reload(),r.value=!1}function E(){return l.value.name?l.value.subject?!l.value.response||l.value.response==="<p></p>"?(m.value="Content is required",!1):!0:(m.value="Subject is required",!1):(m.value="Name is required",!1)}return S(()=>r.value,a=>{a&&(i.value=!1,m.value="",O(()=>{l.value.name?h.value.el.focus():w.value.el.focus(),l.value={..._.emailTemplate},l.value.name&&(i.value=!0)}))}),(a,e)=>{const d=c("TextInput"),f=c("FormControl"),y=c("ErrorMessage"),F=c("Dialog");return b(),g(F,{modelValue:r.value,"onUpdate:modelValue":e[7]||(e[7]=n=>r.value=n),options:{title:i.value?a.__(p.emailTemplate.name):a.__("Create Email Template"),size:"xl",actions:[{label:i.value?a.__("Update"):a.__("Create"),variant:"solid",onClick:()=>i.value?R():N()}]}},{"body-content":I(()=>[o("div",H,[o("div",J,[o("div",L,[o("div",P,[T(v(a.__("Name"))+" ",1),e[8]||(e[8]=o("span",{class:"text-red-500"},"*",-1))]),s(d,{ref_key:"nameRef",ref:w,variant:"outline",modelValue:t(l).name,"onUpdate:modelValue":e[0]||(e[0]=n=>t(l).name=n),placeholder:a.__("Payment Reminder")},null,8,["modelValue","placeholder"])]),o("div",$,[o("div",A,v(a.__("Doctype")),1),s(t(q),{variant:"outline",modelValue:t(l).reference_doctype,"onUpdate:modelValue":e[1]||(e[1]=n=>t(l).reference_doctype=n),options:["CRM Deal","CRM Lead"],placeholder:a.__("CRM Deal")},null,8,["modelValue","placeholder"])])]),o("div",null,[o("div",G,[T(v(a.__("Subject"))+" ",1),e[9]||(e[9]=o("span",{class:"text-red-500"},"*",-1))]),s(d,{ref_key:"subjectRef",ref:h,variant:"outline",modelValue:t(l).subject,"onUpdate:modelValue":e[2]||(e[2]=n=>t(l).subject=n),placeholder:a.__("Payment Reminder from Frappé - (#{{ name }})")},null,8,["modelValue","placeholder"])]),o("div",null,[o("div",K,[T(v(a.__("Content"))+" ",1),e[10]||(e[10]=o("span",{class:"text-red-500"},"*",-1))]),t(l).use_html?(b(),g(f,{key:0,type:"textarea",variant:"outline",ref:"content",rows:10,modelValue:t(l).response_html,"onUpdate:modelValue":e[3]||(e[3]=n=>t(l).response_html=n),placeholder:a.__(`<p>Dear {{ lead_name }},</p>

<p>This is a reminder for the payment of {{ grand_total }}.</p>

<p>Thanks,</p>
<p>Frappé</p>`)},null,8,["modelValue","placeholder"])):(b(),g(t(z),{key:1,variant:"outline",ref:"content","editor-class":"!prose-sm overflow-auto min-h-[180px] max-h-80 py-1.5 px-2 rounded border border-gray-300 bg-white hover:border-gray-400 hover:shadow-sm focus:bg-white focus:border-gray-500 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-gray-400 text-gray-800 transition-colors",bubbleMenu:!0,content:t(l).response,onChange:e[4]||(e[4]=n=>t(l).response=n),placeholder:a.__(`Dear {{ lead_name }}, 

This is a reminder for the payment of {{ grand_total }}. 

Thanks, 
Frappé`)},null,8,["content","placeholder"]))]),o("div",null,[s(t(k),{modelValue:t(l).enabled,"onUpdate:modelValue":e[5]||(e[5]=n=>t(l).enabled=n),label:a.__("Enabled")},null,8,["modelValue","label"])]),o("div",null,[s(t(k),{modelValue:t(l).use_html,"onUpdate:modelValue":e[6]||(e[6]=n=>t(l).use_html=n),label:a.__("Use HTML")},null,8,["modelValue","label"])]),s(y,{message:a.__(m.value)},null,8,["message"])])]),_:1},8,["modelValue","options"])}}};export{Y as _};
//# sourceMappingURL=EmailTemplateModal-77cc8111.js.map
