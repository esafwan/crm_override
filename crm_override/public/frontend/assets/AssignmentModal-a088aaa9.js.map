{"version":3,"file":"AssignmentModal-a088aaa9.js","sources":["../../../../frontend/src/components/Modals/AssignmentModal.vue"],"sourcesContent":["<template>\n  <Dialog\n    v-model=\"show\"\n    :options=\"{\n      title: __('Assign To'),\n      size: 'xl',\n      actions: [\n        {\n          label: __('Cancel'),\n          variant: 'subtle',\n          onClick: () => {\n            assignees = [...oldAssignees]\n            show = false\n          },\n        },\n        {\n          label: __('Update'),\n          variant: 'solid',\n          onClick: () => updateAssignees(),\n        },\n      ],\n    }\"\n    @close=\"\n      () => {\n        assignees = [...oldAssignees]\n      }\n    \"\n  >\n    <template #body-content>\n      <Link\n        class=\"form-control\"\n        value=\"\"\n        doctype=\"User\"\n        @change=\"(option) => addValue(option) && ($refs.input.value = '')\"\n        :placeholder=\"__('John Doe')\"\n        :hideMe=\"true\"\n      >\n        <template #item-prefix=\"{ option }\">\n          <UserAvatar class=\"mr-2\" :user=\"option.value\" size=\"sm\" />\n        </template>\n        <template #item-label=\"{ option }\">\n          <Tooltip :text=\"option.value\">\n            <div class=\"cursor-pointer\">\n              {{ getUser(option.value).full_name }}\n            </div>\n          </Tooltip>\n        </template>\n      </Link>\n      <div class=\"mt-3 flex flex-wrap items-center gap-2\">\n        <Tooltip\n          :text=\"assignee.name\"\n          v-for=\"assignee in assignees\"\n          :key=\"assignee.name\"\n        >\n          <Button\n            :label=\"getUser(assignee.name).full_name\"\n            theme=\"gray\"\n            variant=\"outline\"\n          >\n            <template #prefix>\n              <UserAvatar :user=\"assignee.name\" size=\"sm\" />\n            </template>\n            <template #suffix>\n              <FeatherIcon\n                v-if=\"assignee.name !== owner\"\n                class=\"h-3.5\"\n                name=\"x\"\n                @click.stop=\"removeValue(assignee.name)\"\n              />\n            </template>\n          </Button>\n        </Tooltip>\n      </div>\n      <ErrorMessage class=\"mt-2\" v-if=\"error\" :message=\"__(error)\" />\n    </template>\n  </Dialog>\n</template>\n\n<script setup>\nimport UserAvatar from '@/components/UserAvatar.vue'\nimport Link from '@/components/Controls/Link.vue'\nimport { usersStore } from '@/stores/users'\nimport { capture } from '@/telemetry'\nimport { Tooltip, call } from 'frappe-ui'\nimport { ref, computed, onMounted } from 'vue'\n\nconst props = defineProps({\n  doc: {\n    type: Object,\n    default: null,\n  },\n  docs: {\n    type: Set,\n    default: new Set(),\n  },\n  doctype: {\n    type: String,\n    default: '',\n  },\n})\n\nconst emit = defineEmits(['reload'])\n\nconst show = defineModel()\nconst assignees = defineModel('assignees')\nconst oldAssignees = ref([])\n\nconst error = ref('')\n\nconst { getUser } = usersStore()\n\nconst removeValue = (value) => {\n  assignees.value = assignees.value.filter(\n    (assignee) => assignee.name !== value,\n  )\n}\n\nconst owner = computed(() => {\n  if (!props.doc) return ''\n  if (props.doctype == 'CRM Lead') return props.doc.lead_owner\n  return props.doc.deal_owner\n})\n\nconst addValue = (value) => {\n  error.value = ''\n  let obj = {\n    name: value,\n    image: getUser(value).user_image,\n    label: getUser(value).full_name,\n  }\n  if (!assignees.value.find((assignee) => assignee.name === value)) {\n    assignees.value.push(obj)\n  }\n}\n\nfunction updateAssignees() {\n  if (assignees.value.length === 0) {\n    error.value = 'Please select at least one assignee'\n    return\n  }\n  const removedAssignees = oldAssignees.value\n    .filter(\n      (assignee) => !assignees.value.find((a) => a.name === assignee.name),\n    )\n    .map((assignee) => assignee.name)\n\n  const addedAssignees = assignees.value\n    .filter(\n      (assignee) => !oldAssignees.value.find((a) => a.name === assignee.name),\n    )\n    .map((assignee) => assignee.name)\n\n  if (removedAssignees.length) {\n    for (let a of removedAssignees) {\n      call('frappe.desk.form.assign_to.remove', {\n        doctype: props.doctype,\n        name: props.doc.name,\n        assign_to: a,\n      })\n    }\n  }\n\n  if (addedAssignees.length) {\n    if (props.docs.size) {\n      capture('bulk_assign_to', { doctype: props.doctype })\n      call('frappe.desk.form.assign_to.add_multiple', {\n        doctype: props.doctype,\n        name: JSON.stringify(Array.from(props.docs)),\n        assign_to: addedAssignees,\n        bulk_assign: true,\n        re_assign: true,\n      }).then(() => {\n        emit('reload')\n      })\n    } else {\n      capture('assign_to', { doctype: props.doctype })\n      call('frappe.desk.form.assign_to.add', {\n        doctype: props.doctype,\n        name: props.doc.name,\n        assign_to: addedAssignees,\n      })\n    }\n  }\n  show.value = false\n}\n\nonMounted(() => {\n  oldAssignees.value = [...assignees.value]\n})\n</script>\n"],"names":["props","__props","emit","__emit","show","_useModel","assignees","oldAssignees","ref","error","getUser","usersStore","removeValue","value","assignee","owner","computed","addValue","obj","updateAssignees","removedAssignees","a","addedAssignees","call","capture","onMounted"],"mappings":"qnBAsFA,MAAMA,EAAQC,EAeRC,EAAOC,EAEPC,EAAOC,gBAAY,EACnBC,EAAYD,EAAWJ,EAAC,WAAW,EACnCM,EAAeC,EAAI,EAAE,EAErBC,EAAQD,EAAI,EAAE,EAEd,CAAE,QAAAE,CAAS,EAAGC,EAAY,EAE1BC,EAAeC,GAAU,CAC7BP,EAAU,MAAQA,EAAU,MAAM,OAC/BQ,GAAaA,EAAS,OAASD,CACjC,CACH,EAEME,EAAQC,EAAS,IAChBhB,EAAM,IACPA,EAAM,SAAW,WAAmBA,EAAM,IAAI,WAC3CA,EAAM,IAAI,WAFM,EAGxB,EAEKiB,EAAYJ,GAAU,CAC1BJ,EAAM,MAAQ,GACd,IAAIS,EAAM,CACR,KAAML,EACN,MAAOH,EAAQG,CAAK,EAAE,WACtB,MAAOH,EAAQG,CAAK,EAAE,SACvB,EACIP,EAAU,MAAM,KAAMQ,GAAaA,EAAS,OAASD,CAAK,GAC7DP,EAAU,MAAM,KAAKY,CAAG,CAE5B,EAEA,SAASC,GAAkB,CACzB,GAAIb,EAAU,MAAM,SAAW,EAAG,CAChCG,EAAM,MAAQ,sCACd,MACD,CACD,MAAMW,EAAmBb,EAAa,MACnC,OACEO,GAAa,CAACR,EAAU,MAAM,KAAMe,GAAMA,EAAE,OAASP,EAAS,IAAI,CACpE,EACA,IAAKA,GAAaA,EAAS,IAAI,EAE5BQ,EAAiBhB,EAAU,MAC9B,OACEQ,GAAa,CAACP,EAAa,MAAM,KAAMc,GAAMA,EAAE,OAASP,EAAS,IAAI,CACvE,EACA,IAAKA,GAAaA,EAAS,IAAI,EAElC,GAAIM,EAAiB,OACnB,QAASC,KAAKD,EACZG,EAAK,oCAAqC,CACxC,QAASvB,EAAM,QACf,KAAMA,EAAM,IAAI,KAChB,UAAWqB,CACnB,CAAO,EAIDC,EAAe,SACbtB,EAAM,KAAK,MACbwB,EAAQ,iBAAkB,CAAE,QAASxB,EAAM,OAAO,CAAE,EACpDuB,EAAK,0CAA2C,CAC9C,QAASvB,EAAM,QACf,KAAM,KAAK,UAAU,MAAM,KAAKA,EAAM,IAAI,CAAC,EAC3C,UAAWsB,EACX,YAAa,GACb,UAAW,EACnB,CAAO,EAAE,KAAK,IAAM,CACZpB,EAAK,QAAQ,CACrB,CAAO,IAEDsB,EAAQ,YAAa,CAAE,QAASxB,EAAM,OAAO,CAAE,EAC/CuB,EAAK,iCAAkC,CACrC,QAASvB,EAAM,QACf,KAAMA,EAAM,IAAI,KAChB,UAAWsB,CACnB,CAAO,IAGLlB,EAAK,MAAQ,EACf,CAEA,OAAAqB,EAAU,IAAM,CACdlB,EAAa,MAAQ,CAAC,GAAGD,EAAU,KAAK,CAC1C,CAAC"}