import{u as $,n as O,p as j,a as b,_ as z,m as L,x as P}from"./index-8340263f.js";import{A}from"./ArrowUpRightIcon-60e3a514.js";import{T as J,_ as N,D as E}from"./views-5c6870e6.js";import{_ as q,m as h,i as w,v as F,l as _,a as G,k as H,r as v,b as T,g as x,w as o,e as r,t as f,d as l,p as K,u as i,I as M,z as Q,A as W}from"./index-82d0b844.js";import{D}from"./Dropdown-f8d4a8c8.js";const X={class:"flex items-center gap-3"},Y={class:"text-2xl font-semibold leading-6 text-gray-900"},Z={class:"flex flex-col gap-4"},ee={class:"mb-1.5 text-sm text-gray-600"},ae={class:"mb-1.5 text-sm text-gray-600"},te={class:"flex flex-wrap items-center gap-2"},se={class:"cursor-pointer"},le={__name:"TaskModal",props:h({task:{type:Object,default:{}},doctype:{type:String,default:"CRM Lead"},doc:{type:String,default:""}},{modelValue:{},modelModifiers:{},reloadTasks:{},reloadTasksModifiers:{}}),emits:h(["updateTask"],["update:modelValue","update:reloadTasks"]),setup(u,{emit:oe}){const d=u,c=w(u,"modelValue"),k=w(u,"reloadTasks"),C=F(),{getUser:m}=$(),y=_(null),p=_(!1),a=_({title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:d.doctype,reference_docname:null});function V(e){a.value.status=e}function I(e){a.value.priority=e}function R(){var n;if(!((n=d.task)!=null&&n.reference_docname))return;let e=d.task.reference_doctype=="CRM Deal"?"Deal":"Lead",t={leadId:d.task.reference_docname};e=="Deal"&&(t={dealId:d.task.reference_docname}),C.push({name:e,params:t})}async function U(){a.value.assigned_to||(a.value.assigned_to=m().name),a.value.name?(await M("frappe.client.set_value",{doctype:"CRM Task",name:a.value.name,fieldname:a.value})).name&&k.value.reload():(await M("frappe.client.insert",{doc:{doctype:"CRM Task",reference_doctype:d.doctype,reference_docname:d.doc||null,...a.value}})).name&&(Q("task_created"),k.value.reload()),c.value=!1}function g(){p.value=!1,W(()=>{var e,t,n;(n=(t=(e=y.value)==null?void 0:e.el)==null?void 0:t.focus)==null||n.call(t),a.value={...d.task},a.value.title&&(p.value=!0)})}return G(()=>c.value&&g()),H(c,e=>{e&&g()}),(e,t)=>{const n=v("Button"),B=v("TextInput"),S=v("Dialog");return T(),x(S,{modelValue:c.value,"onUpdate:modelValue":t[5]||(t[5]=s=>c.value=s),options:{size:"xl",actions:[{label:p.value?e.__("Update"):e.__("Create"),variant:"solid",onClick:()=>U()}]}},{"body-title":o(()=>{var s;return[r("div",X,[r("h3",Y,f(p.value?e.__("Edit Task"):e.__("Create Task")),1),(s=u.task)!=null&&s.reference_docname?(T(),x(n,{key:0,variant:"outline",size:"sm",label:u.task.reference_doctype=="CRM Deal"?e.__("Open Deal"):e.__("Open Lead"),onClick:t[0]||(t[0]=ne=>R())},{suffix:o(()=>[l(A,{class:"h-4 w-4"})]),_:1},8,["label"])):K("",!0)])]}),"body-content":o(()=>[r("div",Z,[r("div",null,[r("div",ee,f(e.__("Title")),1),l(B,{ref_key:"title",ref:y,variant:"outline",modelValue:a.value.title,"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.title=s),placeholder:e.__("Call with John Doe")},null,8,["modelValue","placeholder"])]),r("div",null,[r("div",ae,f(e.__("Description")),1),l(i(J),{variant:"outline",ref:"description","editor-class":"!prose-sm overflow-auto min-h-[80px] max-h-80 py-1.5 px-2 rounded border border-gray-300 bg-white hover:border-gray-400 hover:shadow-sm focus:bg-white focus:border-gray-500 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-gray-400 text-gray-800 transition-colors",bubbleMenu:!0,content:a.value.description,onChange:t[2]||(t[2]=s=>a.value.description=s),placeholder:e.__("Took a call with John Doe and discussed the new project.")},null,8,["content","placeholder"])]),r("div",te,[l(i(D),{options:i(j)(V)},{default:o(()=>[l(n,{label:a.value.status,class:"w-full justify-between"},{prefix:o(()=>[l(O,{status:a.value.status},null,8,["status"])]),_:1},8,["label"])]),_:1},8,["options"]),l(N,{class:"form-control",value:i(m)(a.value.assigned_to).full_name,doctype:"User",onChange:t[3]||(t[3]=s=>a.value.assigned_to=s),placeholder:e.__("John Doe"),hideMe:!0},{prefix:o(()=>[l(b,{class:"mr-2 !h-4 !w-4",user:a.value.assigned_to},null,8,["user"])]),"item-prefix":o(({option:s})=>[l(b,{class:"mr-2",user:s.value,size:"sm"},null,8,["user"])]),"item-label":o(({option:s})=>[l(i(z),{text:s.value},{default:o(()=>[r("div",se,f(i(m)(s.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["value","placeholder"]),l(i(E),{class:"datepicker w-36",modelValue:a.value.due_date,"onUpdate:modelValue":t[4]||(t[4]=s=>a.value.due_date=s),placeholder:e.__("01/04/2024 11:30 PM"),"input-class":"border-none"},null,8,["modelValue","placeholder"]),l(i(D),{options:i(P)(I)},{default:o(()=>[l(n,{label:a.value.priority,class:"w-full justify-between"},{prefix:o(()=>[l(L,{priority:a.value.priority},null,8,["priority"])]),_:1},8,["label"])]),_:1},8,["options"])])])]),_:1},8,["modelValue","options"])}}},pe=q(le,[["__scopeId","data-v-91ec8a6a"]]);export{pe as T};
//# sourceMappingURL=TaskModal-16274f1c.js.map
