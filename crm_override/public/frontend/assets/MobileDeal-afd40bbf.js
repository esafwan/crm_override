import{_ as ve}from"./GroupByIcon-584f979a.js";import{D as ge}from"./DetailsIcon-f2258ff1.js";import{A as ye,E as he,S as be,a as xe,L as Ce,_ as we}from"./SLASection-72cc8d88.js";import{E as Ie}from"./Email2Icon-c181bc5b.js";import{C as ke}from"./CommentIcon-fd4d721b.js";import{P as H}from"./PhoneIcon-3c556b02.js";import{T as De}from"./TaskIcon-5ecf8abe.js";import{N as Ve}from"./NoteModal-fe2f5600.js";import{W as ze}from"./WhatsAppIcon-67297c1d.js";import{I as Se}from"./IndicatorIcon-d1b8f59f.js";import{A as $e}from"./ArrowUpRightIcon-60e3a514.js";import{S as Ae}from"./Fields-ea2aa0dd.js";import{_ as Ue}from"./LayoutHeader-ce3efb9b.js";import{_ as Ee}from"./OrganizationModal-1b108108.js";import{_ as Te}from"./AssignmentModal-a088aaa9.js";import{s as Me,_ as Re}from"./statuses-3dacf993.js";import{C as qe}from"./ContactModal-cf8a9129.js";import{_ as Be}from"./views-5c6870e6.js";import{_ as J}from"./Section-2652928e.js";import{_ as je}from"./CustomActions-d045e678.js";import{g as Ne,s as Fe,h as Le,i as Oe,j as y,b as Pe}from"./index-8340263f.js";import{g as We,_ as Ge}from"./view-eb7d1a47.js";import{o as He}from"./organizations-c51d501b.js";import{i as Je,c as Ke,w as Qe}from"./settings-6089b88c.js";import{h as Xe,v as Ye,x as A,a as Ze,l as h,j as q,r as B,b as i,c,u as t,g as v,w as m,p as _,G as ea,e as u,d as r,F as j,I as k,n as U,f as K,t as D,H as Q,L as aa,B as ta}from"./index-82d0b844.js";import{_ as oa}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-cd1be04a.js";import{D as X}from"./Dropdown-f8d4a8c8.js";import"./CalendarIcon-5c294322.js";import"./callLog-0801e3f3.js";import"./contacts-226dfac2.js";import"./Dropdown-57634c86.js";import"./FadedScrollableDiv-5302c81a.js";import"./FileUploader-b4f98b38.js";import"./LeadsIcon-186f8b9f.js";import"./DealsIcon-491a0387.js";import"./EmailTemplateModal-77cc8111.js";import"./TaskModal-16274f1c.js";import"./NestedPopover-9b04b27b.js";import"./EditIcon-3c54f763.js";import"./OrganizationsIcon-557bc8d4.js";const sa={class:"relative flex h-12 items-center justify-between gap-2 py-2.5 pl-5"},na={class:"absolute right-0"},la={key:1,class:"flex h-12 items-center justify-between gap-2 border-b px-3 py-2.5"},ia={class:"flex items-center gap-2"},ra={key:2,class:"flex h-full overflow-hidden"},da={key:0},ma={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},ca={class:"flex flex-col overflow-y-auto"},ua={key:0,class:"pr-2"},pa={key:1},_a={key:0,class:"flex min-h-20 flex-1 items-center justify-center gap-3 text-base text-gray-500"},fa={class:"flex cursor-pointer items-center justify-between gap-2 pr-1 text-base leading-5 text-gray-700"},va=["onClick"],ga={class:"truncate"},ya={class:"flex items-center"},ha={class:"flex flex-col gap-1.5 text-base text-gray-800"},ba={class:"flex items-center gap-3 pb-1.5 pl-1 pt-4"},xa={class:"flex items-center gap-3 p-1 py-1.5"},Ca={key:0,class:"mx-2 h-px border-t border-gray-200"},wa={key:2,class:"flex h-20 items-center justify-center text-base text-gray-600"},mt={__name:"MobileDeal",props:{dealId:{type:String,required:!0}},setup(Y){const{$dialog:Z}=Ne(),{organizations:ee,getOrganization:ae}=He(),{statusOptions:te,getDealStatus:oe}=Me(),b=Xe(),V=Ye(),f=Y,o=A({url:"crm.fcrm.doctype.crm_deal.api.get_deal",params:{name:f.dealId},cache:["deal",f.dealId],onSuccess:a=>{let e={doc:a,$dialog:Z,router:V,updateField:w,createToast:y,deleteDoc:pe,call:k};Fe(a),Le(a,e),Oe(a,e)}});Ze(()=>{o.data||o.fetch()});const E=h(!1),T=h(!1),z=h(!1),M=h({}),se=q(()=>{var a;return((a=o.data)==null?void 0:a.organization)&&ae(o.data.organization)});function ne(a,e,s){e=Array.isArray(a)?"":e,!le(a,e)&&A({url:"frappe.client.set_value",params:{doctype:"CRM Deal",name:f.dealId,fieldname:a,value:e},auto:!0,onSuccess:()=>{o.reload(),E.value=!0,y({title:__("Deal updated"),icon:"check",iconClasses:"text-green-600"}),s==null||s()},onError:l=>{var x;y({title:__("Error updating deal"),text:__((x=l.messages)==null?void 0:x[0]),icon:"x",iconClasses:"text-red-600"})}})}function le(a,e){var l;let s=o.data.fields_meta||{};return(l=s[a])!=null&&l.reqd&&!e?(y({title:__("Error Updating Deal"),text:__("{0} is a required field",[s[a].label]),icon:"x",iconClasses:"text-red-600"}),!0):!1}const ie=q(()=>{var e;let a=[{label:__("Deals"),route:{name:"Deals"}}];if(b.query.view||b.query.viewType){let s=We(b.query.view,b.query.viewType,"CRM Deal");s&&a.push({label:__(s.label),icon:s.icon,route:{name:"Deals",params:{viewType:b.query.viewType},query:{view:b.query.view}}})}return a.push({label:((e=se.value)==null?void 0:e.name)||__("Untitled"),route:{name:"Deal",params:{dealId:o.data.name}}}),a}),S=h(0),re=q(()=>[{name:"Details",label:__("Details"),icon:ge,condition:()=>Je.value},{name:"Activity",label:__("Activity"),icon:ye},{name:"Emails",label:__("Emails"),icon:he},{name:"Comments",label:__("Comments"),icon:ke},{name:"Calls",label:__("Calls"),icon:H,condition:()=>Ke.value},{name:"Tasks",label:__("Tasks"),icon:De},{name:"Notes",label:__("Notes"),icon:Ve},{name:"WhatsApp",label:__("WhatsApp"),icon:ze,condition:()=>Qe.value}].filter(e=>e.condition?e.condition():!0)),$=A({url:"crm.api.doc.get_sidebar_fields",cache:["fieldsLayout",f.dealId],params:{doctype:"CRM Deal",name:f.dealId},auto:!0,transform:a=>de(a)});function de(a){return a.forEach(e=>{e.name!="contacts_section"&&e.fields.forEach(s=>{s.name=="organization"&&(s.create=(l,x)=>{M.value.organization_name=l,T.value=!0,x()},s.link=l=>V.push({name:"Organization",params:{organizationId:l}}))})}),a}const R=h(!1),N=h({});function me(a){let e=[{label:__("Delete"),icon:"trash-2",onClick:()=>ce(a)}];return a.is_primary||e.push({label:__("Set as Primary Contact"),icon:ta(Ae,{class:"h-4 w-4"}),onClick:()=>ue(a)}),e}async function F(a){await k("crm.fcrm.doctype.crm_deal.crm_deal.add_contact",{deal:f.dealId,contact:a})&&(C.reload(),y({title:__("Contact added"),icon:"check",iconClasses:"text-green-600"}))}async function ce(a){await k("crm.fcrm.doctype.crm_deal.crm_deal.remove_contact",{deal:f.dealId,contact:a})&&(C.reload(),y({title:__("Contact removed"),icon:"check",iconClasses:"text-green-600"}))}async function ue(a){await k("crm.fcrm.doctype.crm_deal.crm_deal.set_primary_contact",{deal:f.dealId,contact:a})&&(C.reload(),y({title:__("Primary contact set"),icon:"check",iconClasses:"text-green-600"}))}const C=A({url:"crm.fcrm.doctype.crm_deal.api.get_deal_contacts",params:{name:f.dealId},cache:["deal_contacts",f.dealId],auto:!0,onSuccess:a=>{var s;let e=(s=$.data)==null?void 0:s.find(l=>l.name=="contacts_section");e&&(e.contacts=a.map(l=>({name:l.name,full_name:l.full_name,email:l.email,mobile_no:l.mobile_no,image:l.image,is_primary:l.is_primary,opened:!1})))}});function w(a,e,s){ne(a,e,()=>{o.data[a]=e,s==null||s()})}async function pe(a){await k("frappe.client.delete",{doctype:"CRM Deal",name:a}),V.push({name:"Deals"})}return(a,e)=>{var L;const s=B("FeatherIcon"),l=B("Button"),x=B("Badge");return i(),c(j,null,[t(o).data?(i(),v(Ue,{key:0},{default:m(()=>[u("header",sa,[r(t(oa),{items:ie.value},{prefix:m(({item:n})=>[n.icon?(i(),v(ve,{key:0,icon:n.icon,class:"mr-2 h-4"},null,8,["icon"])):_("",!0)]),_:1},8,["items"]),u("div",na,[r(t(X),{options:t(te)("deal",w,t(o).data._customStatuses)},{default:m(({open:n})=>[r(l,{label:t(o).data.status,class:U(t(oe)(t(o).data.status).colorClass)},{prefix:m(()=>[r(Se)]),suffix:m(()=>[r(s,{name:n?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label","class"])]),_:1},8,["options"])])])]),_:1})):_("",!0),t(o).data?(i(),c("div",la,[(i(),v(ea(((L=t(o).data._assignedTo)==null?void 0:L.length)==1?"Button":"div"),null,{default:m(()=>[r(Re,{avatars:t(o).data._assignedTo,onClick:e[0]||(e[0]=n=>z.value=!0)},null,8,["avatars"])]),_:1})),u("div",ia,[t(o).data._customActions?(i(),v(je,{key:0,actions:t(o).data._customActions},null,8,["actions"])):_("",!0)])])):_("",!0),t(o).data?(i(),c("div",ra,[r(t(Ge),{modelValue:S.value,"onUpdate:modelValue":e[7]||(e[7]=n=>S.value=n),tabs:re.value,tablistClass:"!px-3",class:"overflow-auto"},{default:m(({tab:n})=>[n.name=="Details"?(i(),c("div",da,[t(o).data.sla_status?(i(),v(be,{key:0,modelValue:t(o).data,"onUpdate:modelValue":e[1]||(e[1]=d=>t(o).data=d),onUpdateField:w},null,8,["modelValue"])):_("",!0),t($).data?(i(),c("div",ma,[u("div",ca,[(i(!0),c(j,null,K(t($).data,(d,_e)=>(i(),c("div",{key:d.label,class:U(["flex flex-col px-2 py-3 sm:p-3",{"border-b":_e!==t($).data.length-1}])},[r(J,{"is-opened":d.opened,label:d.label},{actions:m(()=>[d.contacts?(i(),c("div",ua,[r(Be,{value:"",doctype:"Contact",onChange:e[2]||(e[2]=g=>F(g)),onCreate:(g,I)=>{N.value={first_name:g,company_name:t(o).data.organization},R.value=!0,I()}},{target:m(({togglePopover:g})=>[r(l,{class:"h-7 px-3",variant:"ghost",icon:"plus",onClick:I=>g()},null,8,["onClick"])]),_:1},8,["onCreate"])])):_("",!0)]),default:m(()=>{var g,I,O;return[d.fields?(i(),v(xe,{key:0,fields:d.fields,modelValue:t(o).data,"onUpdate:modelValue":e[3]||(e[3]=p=>t(o).data=p),onUpdate:w},null,8,["fields","modelValue"])):(i(),c("div",pa,[(g=t(C))!=null&&g.loading&&((O=(I=t(C))==null?void 0:I.data)==null?void 0:O.length)==0?(i(),c("div",_a,[r(Ce,{class:"h-4 w-4"}),u("span",null,D(a.__("Loading...")),1)])):d.contacts.length?(i(!0),c(j,{key:1},K(d.contacts,(p,P)=>(i(),c("div",{key:p.name},[u("div",{class:U(["px-2 pb-2.5",[P==0?"pt-5":"pt-2.5"]])},[r(J,{"is-opened":p.opened},{header:m(({opened:fe,toggle:W})=>[u("div",fa,[u("div",{class:"flex h-7 items-center gap-2 truncate",onClick:G=>W()},[r(t(Pe),{label:p.full_name,image:p.image,size:"md"},null,8,["label","image"]),u("div",ga,D(p.full_name),1),p.is_primary?(i(),v(x,{key:0,class:"ml-2",variant:"outline",label:a.__("Primary"),theme:"green"},null,8,["label"])):_("",!0)],8,va),u("div",ya,[r(t(X),{options:me(p.name)},{default:m(()=>[r(l,{icon:"more-horizontal",class:"text-gray-600",variant:"ghost"})]),_:2},1032,["options"]),r(l,{variant:"ghost",onClick:G=>t(V).push({name:"Contact",params:{contactId:p.name}})},{default:m(()=>[r($e,{class:"h-4 w-4"})]),_:2},1032,["onClick"]),r(l,{variant:"ghost",onClick:G=>W()},{default:m(()=>[r(s,{name:"chevron-right",class:U(["h-4 w-4 text-gray-900 transition-all duration-300 ease-in-out",{"rotate-90":fe}])},null,8,["class"])]),_:2},1032,["onClick"])])])]),default:m(()=>[u("div",ha,[u("div",ba,[r(Ie,{class:"h-4 w-4"}),Q(" "+D(p.email),1)]),u("div",xa,[r(H,{class:"h-4 w-4"}),Q(" "+D(p.mobile_no),1)])])]),_:2},1032,["is-opened"])],2),P!=d.contacts.length-1?(i(),c("div",Ca)):_("",!0)]))),128)):(i(),c("div",wa,D(a.__("No contacts added")),1))]))]}),_:2},1032,["is-opened","label"])],2))),128))])])):_("",!0)])):(i(),v(we,{key:1,doctype:"CRM Deal",title:n.name,reload:E.value,"onUpdate:reload":e[4]||(e[4]=d=>E.value=d),tabIndex:S.value,"onUpdate:tabIndex":e[5]||(e[5]=d=>S.value=d),modelValue:t(o),"onUpdate:modelValue":e[6]||(e[6]=d=>aa(o)?o.value=d:null)},null,8,["title","reload","tabIndex","modelValue"]))]),_:1},8,["modelValue","tabs"])])):_("",!0),r(Ee,{modelValue:T.value,"onUpdate:modelValue":e[8]||(e[8]=n=>T.value=n),organization:M.value,"onUpdate:organization":e[9]||(e[9]=n=>M.value=n),options:{redirect:!1,afterInsert:n=>w("organization",n.name,()=>{t(ee).reload()})}},null,8,["modelValue","organization","options"]),r(qe,{modelValue:R.value,"onUpdate:modelValue":e[10]||(e[10]=n=>R.value=n),contact:N.value,options:{redirect:!1,afterInsert:n=>F(n.name)}},null,8,["modelValue","contact","options"]),z.value?(i(),v(Te,{key:3,modelValue:z.value,"onUpdate:modelValue":e[11]||(e[11]=n=>z.value=n),assignees:t(o).data._assignedTo,"onUpdate:assignees":e[12]||(e[12]=n=>t(o).data._assignedTo=n),doc:t(o).data,doctype:"CRM Deal"},null,8,["modelValue","assignees","doc"])):_("",!0)],64)}}};export{mt as default};
//# sourceMappingURL=MobileDeal-afd40bbf.js.map
