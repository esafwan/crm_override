import{m as _e,i as ee,v as pe,l as y,y as ue,x as te,j as F,a as me,r as U,b as o,g as k,w as C,e as m,t as w,u as h,d,p as f,z as ve,A as fe,h as ge,c as v,F as be,n as ae,q as ye,B as j}from"./index-82d0b844.js";import{_ as ke,a as xe}from"./ViewControls-4c2465f0.js";import{s as re,_ as Ce}from"./statuses-3dacf993.js";import{_ as we}from"./CustomActions-d045e678.js";import{E as he}from"./EmailAtIcon-1abccd22.js";import{P as Ve}from"./PhoneIcon-3c556b02.js";import{_ as De,N as se}from"./NoteModal-fe2f5600.js";import{T as le}from"./TaskIcon-5ecf8abe.js";import{C as Ee}from"./CommentIcon-fd4d721b.js";import{I as H}from"./IndicatorIcon-d1b8f59f.js";import{D as Me}from"./DealsIcon-491a0387.js";import{_ as ze}from"./LayoutHeader-ce3efb9b.js";import{_ as $e}from"./DealsListView-5d1fed0b.js";import{_ as Ue}from"./KanbanView-6155680d.js";import{E as Se}from"./EditIcon-3c54f763.js";import{F as Ie}from"./Fields-ea2aa0dd.js";import{u as ie,g as Re,e as Te,t as X,d as Y,f as Ae,b as P,_ as oe,c as Z}from"./index-8340263f.js";import{_ as ne}from"./Switch.vue_vue_type_script_setup_true_lang-d07933ba.js";import{T as qe}from"./TaskModal-16274f1c.js";import{_ as Oe}from"./QuickEntryModal-91fa4073.js";import{o as Le}from"./organizations-c51d501b.js";import{c as Be}from"./settings-6089b88c.js";import{D as je}from"./Dropdown-f8d4a8c8.js";import"./GroupByIcon-584f979a.js";import"./Dropdown-57634c86.js";import"./views-5c6870e6.js";import"./NestedPopover-9b04b27b.js";import"./PinIcon-d3dd27b0.js";import"./FadedScrollableDiv-5302c81a.js";import"./DetailsIcon-f2258ff1.js";import"./DragVerticalIcon-71ed262e.js";import"./ArrowUpRightIcon-60e3a514.js";import"./ListBulkActions-6a63e81f.js";import"./AssignmentModal-a088aaa9.js";import"./ListRows-d5bf097d.js";import"./ListFooter-621c0d06.js";import"./label-16764775.js";const Pe={class:"bg-white px-4 pb-6 pt-5 sm:px-6"},Qe={class:"mb-5 flex items-center justify-between"},Ke={class:"text-2xl font-semibold leading-6 text-gray-900"},We={class:"flex items-center gap-1"},Ge={class:"mb-4 grid grid-cols-1 gap-4 sm:grid-cols-3"},Je={class:"flex items-center gap-3 text-sm text-gray-600"},He={class:"flex items-center gap-3 text-sm text-gray-600"},Xe={class:"px-4 pb-7 pt-4 sm:px-6"},Ye={class:"flex flex-row-reverse gap-2"},Ze={__name:"DealModal",props:_e({defaults:Object},{modelValue:{},modelModifiers:{},quickEntry:{},quickEntryModifiers:{}}),emits:["update:modelValue","update:quickEntry"],setup(O){const Q=O,{getUser:S,isManager:K}=ie(),{getDealStatus:L,statusOptions:T}=re(),D=ee(O,"modelValue"),E=pe(),g=y(null),c=ue({organization:"",organization_name:"",website:"",no_of_employees:"",territory:"",annual_revenue:"",industry:"",contact:"",salutation:"",first_name:"",last_name:"",email:"",mobile_no:"",gender:"",status:"",deal_owner:""}),n=y(!1),z=y(!1),$=y(!1),A=te({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["quickEntryFields","CRM Deal"],params:{doctype:"CRM Deal",type:"Quick Entry"},auto:!0,transform:i=>i.forEach(b=>{b.fields.forEach(p=>{p.name=="status"?(p.type="Select",p.options=l.value,p.prefix=L(c.status).iconColorClass):p.name=="deal_owner"&&(p.type="User")})})}),V=F(()=>{let i=A.data||[];if(!i.length)return[];let b=[];return $.value?b.push(i.find(p=>p.label==="Select Organization")):b.push(i.find(p=>p.label==="Organization Details")),z.value?b.push(i.find(p=>p.label==="Select Contact")):b.push(i.find(p=>p.label==="Contact Details")),i.forEach(p=>{["Select Organization","Organization Details","Select Contact","Contact Details"].includes(p.label)||b.push(p)}),b}),l=F(()=>{let i=T("deal");return c.status||(c.status=i[0].value),i});function q(){c.website&&!c.website.startsWith("http")&&(c.website="https://"+c.website),te({url:"crm.fcrm.doctype.crm_deal.crm_deal.create_deal",params:{args:c},auto:!0,validate(){if(g.value=null,c.annual_revenue&&(c.annual_revenue=c.annual_revenue.replace(/,/g,""),isNaN(c.annual_revenue)))return g.value=__("Annual Revenue should be a number"),g.value;if(c.mobile_no&&isNaN(c.mobile_no.replace(/[-+() ]/g,"")))return g.value=__("Mobile No should be a number"),g.value;if(c.email&&!c.email.includes("@"))return g.value=__("Invalid Email"),g.value;if(!c.status)return g.value=__("Status is required"),g.value;n.value=!0},onSuccess(i){ve("deal_created"),n.value=!1,D.value=!1,E.push({name:"Deal",params:{dealId:i}})},onError(i){if(n.value=!1,!i.messages){g.value=i.message;return}g.value=i.messages.join(`
`)}})}const W=ee(O,"quickEntry");function G(){W.value=!0,fe(()=>{D.value=!1})}return me(()=>{Object.assign(c,Q.defaults),c.deal_owner||(c.deal_owner=S().name),!c.status&&l.value[0].value&&(c.status=l.value[0].value)}),(i,b)=>{const p=U("Button"),I=U("FeatherIcon"),R=U("ErrorMessage"),J=U("Dialog");return o(),k(J,{modelValue:D.value,"onUpdate:modelValue":b[3]||(b[3]=M=>D.value=M),options:{size:"3xl"}},{body:C(()=>[m("div",Pe,[m("div",Qe,[m("div",null,[m("h3",Ke,w(i.__("Create Deal")),1)]),m("div",We,[h(K)()?(o(),k(p,{key:0,variant:"ghost",class:"w-7",onClick:G},{default:C(()=>[d(Se,{class:"h-4 w-4"})]),_:1})):f("",!0),d(p,{variant:"ghost",class:"w-7",onClick:b[0]||(b[0]=M=>D.value=!1)},{default:C(()=>[d(I,{name:"x",class:"h-4 w-4"})]),_:1})])]),m("div",null,[m("div",Ge,[m("div",Je,[m("div",null,w(i.__("Choose Existing Organization")),1),d(h(ne),{modelValue:$.value,"onUpdate:modelValue":b[1]||(b[1]=M=>$.value=M)},null,8,["modelValue"])]),m("div",He,[m("div",null,w(i.__("Choose Existing Contact")),1),d(h(ne),{modelValue:z.value,"onUpdate:modelValue":b[2]||(b[2]=M=>z.value=M)},null,8,["modelValue"])])]),V.value?(o(),k(Ie,{key:0,class:"border-t pt-4",sections:V.value,data:c},null,8,["sections","data"])):f("",!0),g.value?(o(),k(R,{key:1,class:"mt-4",message:i.__(g.value)},null,8,["message"])):f("",!0)])]),m("div",Xe,[m("div",Ye,[d(p,{variant:"solid",label:i.__("Create"),loading:n.value,onClick:q},null,8,["label","loading"])])])]),_:1},8,["modelValue"])}}},Fe={class:"flex gap-2 items-center"},Ne={key:0},et={key:1},tt={key:2},at={key:3,class:"truncate text-base"},st={key:4,class:"truncate text-base"},lt={key:5,class:"truncate text-base"},ot={key:6,class:"text-gray-500"},nt={key:0,class:"truncate flex items-center gap-2"},ut={key:0},rt={key:1},it={key:2},dt={key:3,class:"truncate text-base"},ct={key:4,class:"truncate text-base"},_t={key:5,class:"flex items-center"},pt={key:6,class:"truncate text-base"},mt={class:"flex gap-2 items-center justify-between"},vt={class:"text-gray-600 flex items-center gap-1.5"},ft={key:0},gt={key:1},bt={key:2},yt={key:3},kt={key:2,class:"flex h-full items-center justify-center"},xt={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},oa={__name:"Deals",setup(O){const{makeCall:Q}=Re(),{getUser:S}=ie(),{getOrganization:K}=Le(),{getDealStatus:L}=re(),T=ge(),D=y(null),E=y(!1),g=y(!1),c=ue({}),n=y({}),z=y(1),$=y(1),A=y(20),V=y(null);function l(u,t){var s;function r(_){return _&&typeof _=="object"&&!Array.isArray(_)?_:{label:_}}return r((s=q.value)==null?void 0:s.find(_=>_.name==u)[t])}const q=F(()=>{var u,t,r,s,_,e,a;return(t=(u=n.value)==null?void 0:u.data)!=null&&t.data?n.value.data.view_type==="group_by"?(s=(r=n.value)==null?void 0:r.data.group_by_field)!=null&&s.name?W((_=n.value)==null?void 0:_.data.data,(e=n.value)==null?void 0:e.data.group_by_field):[]:n.value.data.view_type==="kanban"?G(n.value.data.data):i((a=n.value)==null?void 0:a.data.data):[]});function W(u,t){var s;let r=[];return(s=t.options)==null||s.forEach(_=>{let e=[];_?e=u.filter(x=>x[t.name]==_):e=u.filter(x=>!x[t.name]);let a={label:t.label,group:_||__(" "),collapsed:!1,rows:i(e)};t.name=="status"&&(a.icon=()=>{var x;return j(H,{class:(x=L(_))==null?void 0:x.iconColorClass})}),r.push(a)}),r||u}function G(u){let t=[];return u.forEach(r=>{var s;(s=r.data)==null||s.forEach(_=>{t.push(_)})}),i(t)}function i(u){return u.map(t=>{let r={};return n.value.data.rows.forEach(s=>{var _,e;if(r[s]=t[s],s=="organization")r[s]={label:t.organization,logo:(_=K(t.organization))==null?void 0:_.organization_logo};else if(s=="annual_revenue")r[s]=Te(t.annual_revenue,t.currency);else if(s=="status")r[s]={label:t.status,color:(e=L(t.status))==null?void 0:e.iconColorClass};else if(s=="sla_status"){let a=t.sla_status,x=a,N=t.sla_status=="Failed"?"red":t.sla_status=="Fulfilled"?"green":"orange";a=="First Response Due"&&(a=__(X(t.response_by)),x=Y(t.response_by,Z),new Date(t.response_by)<new Date&&(N="red")),r[s]={label:x,value:a,color:N}}else if(s=="deal_owner")r[s]={label:t.deal_owner&&S(t.deal_owner).full_name,...t.deal_owner&&S(t.deal_owner)};else if(s=="_assign"){let a=JSON.parse(t._assign)||[];!a.length&&t.deal_owner&&(a=[t.deal_owner]),r[s]=a.map(x=>({name:x,image:S(x).user_image,label:S(x).full_name}))}else if(["modified","creation"].includes(s))r[s]={label:Y(t[s],Z),timeAgo:__(X(t[s]))};else if(["first_response_time","first_responded_on","response_by"].includes(s)){let a=s=="response_by"?"response_by":"first_responded_on";r[s]={label:t[a]?Y(t[a],Z):"",timeAgo:t[s]?s=="first_response_time"?Ae(t[s]):__(X(t[s])):""}}}),r._email_count=t._email_count,r._note_count=t._note_count,r._task_count=t._task_count,r._comment_count=t._comment_count,r})}function b(u){let t=n.value.params.column_field;t&&(c[t]=u.column.name),E.value=!0}function p(u){var s;let t=((s=l(u,"mobile_no"))==null?void 0:s.label)||"";return[{icon:j(Ve,{class:"h-4 w-4"}),label:__("Make a Call"),onClick:()=>Q(t),condition:()=>t&&Be.value},{icon:j(se,{class:"h-4 w-4"}),label:__("New Note"),onClick:()=>M(u)},{icon:j(le,{class:"h-4 w-4"}),label:__("New Task"),onClick:()=>ce(u)}].filter(_=>_.condition?_.condition():!0)}const I=y(""),R=y(!1),J=y({title:"",content:""});function M(u){I.value=u,R.value=!0}const B=y(!1),de=y({title:"",description:"",assigned_to:"",due_date:"",priority:"Low",status:"Backlog"});function ce(u){I.value=u,B.value=!0}return(u,t)=>{const r=U("FeatherIcon"),s=U("Button"),_=U("Badge");return o(),v(be,null,[d(ze,null,{"left-header":C(()=>[d(xe,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=e=>V.value=e),routeName:"Deals"},null,8,["modelValue"])]),"right-header":C(()=>{var e;return[(e=D.value)!=null&&e.customListActions?(o(),k(we,{key:0,actions:D.value.customListActions},null,8,["actions"])):f("",!0),d(s,{variant:"solid",label:u.__("Create"),onClick:t[1]||(t[1]=a=>E.value=!0)},{prefix:C(()=>[d(r,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),d(ke,{ref_key:"viewControls",ref:V,modelValue:n.value,"onUpdate:modelValue":t[2]||(t[2]=e=>n.value=e),loadMore:z.value,"onUpdate:loadMore":t[3]||(t[3]=e=>z.value=e),resizeColumn:$.value,"onUpdate:resizeColumn":t[4]||(t[4]=e=>$.value=e),updatedPageCount:A.value,"onUpdate:updatedPageCount":t[5]||(t[5]=e=>A.value=e),doctype:"CRM Deal",options:{allowedViews:["list","group_by","kanban"]}},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),h(T).params.viewType=="kanban"?(o(),k(Ue,{key:0,modelValue:n.value,"onUpdate:modelValue":t[7]||(t[7]=e=>n.value=e),options:{getRoute:e=>({name:"Deal",params:{dealId:e.name},query:{view:h(T).query.view,viewType:h(T).params.viewType}}),onNewClick:e=>b(e)},onUpdate:t[8]||(t[8]=e=>V.value.updateKanbanSettings(e)),onLoadMore:t[9]||(t[9]=e=>V.value.loadMoreKanban(e))},{title:C(({titleField:e,itemName:a})=>[m("div",Fe,[e==="status"?(o(),v("div",Ne,[d(H,{class:ae(l(a,e).color)},null,8,["class"])])):e==="organization"&&l(a,e).label?(o(),v("div",et,[d(h(P),{class:"flex items-center",image:l(a,e).logo,label:l(a,e).label,size:"sm"},null,8,["image","label"])])):e==="deal_owner"&&l(a,e).full_name?(o(),v("div",tt,[d(h(P),{class:"flex items-center",image:l(a,e).user_image,label:l(a,e).full_name,size:"sm"},null,8,["image","label"])])):f("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(o(),v("div",at,[d(h(oe),{text:l(a,e).label},{default:C(()=>[m("div",null,w(l(a,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(o(),v("div",st,[l(a,e).value?(o(),k(_,{key:0,variant:"subtle",theme:l(a,e).color,size:"md",label:l(a,e).value},null,8,["theme","label"])):f("",!0)])):l(a,e).label?(o(),v("div",lt,w(l(a,e).label),1)):(o(),v("div",ot,w(u.__("No Title")),1))])]),fields:C(({fieldName:e,itemName:a})=>[l(a,e).label?(o(),v("div",nt,[e==="status"?(o(),v("div",ut,[d(H,{class:ae(l(a,e).color)},null,8,["class"])])):e==="organization"?(o(),v("div",rt,[l(a,e).label?(o(),k(h(P),{key:0,class:"flex items-center",image:l(a,e).logo,label:l(a,e).label,size:"xs"},null,8,["image","label"])):f("",!0)])):e==="deal_owner"?(o(),v("div",it,[l(a,e).full_name?(o(),k(h(P),{key:0,class:"flex items-center",image:l(a,e).user_image,label:l(a,e).full_name,size:"xs"},null,8,["image","label"])):f("",!0)])):f("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(o(),v("div",dt,[d(h(oe),{text:l(a,e).label},{default:C(()=>[m("div",null,w(l(a,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(o(),v("div",ct,[l(a,e).value?(o(),k(_,{key:0,variant:"subtle",theme:l(a,e).color,size:"md",label:l(a,e).value},null,8,["theme","label"])):f("",!0)])):e==="_assign"?(o(),v("div",_t,[d(Ce,{avatars:l(a,e).label,size:"xs"},null,8,["avatars"])])):(o(),v("div",pt,w(l(a,e).label),1))])):f("",!0)]),actions:C(({itemName:e})=>[m("div",mt,[m("div",vt,[d(he,{class:"h-4 w-4"}),l(e,"_email_count").label?(o(),v("span",ft,w(l(e,"_email_count").label),1)):f("",!0),t[24]||(t[24]=m("span",{class:"text-3xl leading-[0]"}," · ",-1)),d(se,{class:"h-4 w-4"}),l(e,"_note_count").label?(o(),v("span",gt,w(l(e,"_note_count").label),1)):f("",!0),t[25]||(t[25]=m("span",{class:"text-3xl leading-[0]"}," · ",-1)),d(le,{class:"h-4 w-4"}),l(e,"_task_count").label?(o(),v("span",bt,w(l(e,"_task_count").label),1)):f("",!0),t[26]||(t[26]=m("span",{class:"text-3xl leading-[0]"}," · ",-1)),d(Ee,{class:"h-4 w-4"}),l(e,"_comment_count").label?(o(),v("span",yt,w(l(e,"_comment_count").label),1)):f("",!0)]),d(h(je),{class:"flex items-center gap-2",options:p(e),variant:"ghost",onClick:t[6]||(t[6]=ye(()=>{},["stop","prevent"]))},{default:C(()=>[d(s,{icon:"plus",variant:"ghost"})]),_:2},1032,["options"])])]),_:1},8,["modelValue","options"])):n.value.data&&q.value.length?(o(),k($e,{key:1,ref_key:"dealsListView",ref:D,modelValue:n.value.data.page_length_count,"onUpdate:modelValue":t[10]||(t[10]=e=>n.value.data.page_length_count=e),list:n.value,"onUpdate:list":t[11]||(t[11]=e=>n.value=e),rows:q.value,columns:n.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:n.value.data.row_count,totalCount:n.value.data.total_count},onLoadMore:t[12]||(t[12]=()=>z.value++),onColumnWidthUpdated:t[13]||(t[13]=()=>$.value++),onUpdatePageCount:t[14]||(t[14]=e=>A.value=e),onApplyFilter:t[15]||(t[15]=e=>V.value.applyFilter(e)),onApplyLikeFilter:t[16]||(t[16]=e=>V.value.applyLikeFilter(e)),onLikeDoc:t[17]||(t[17]=e=>V.value.likeDoc(e))},null,8,["modelValue","list","rows","columns","options"])):n.value.data?(o(),v("div",kt,[m("div",xt,[d(Me,{class:"h-10 w-10"}),m("span",null,w(u.__("No {0} Found",[u.__("Deals")])),1),d(s,{label:u.__("Create"),onClick:t[18]||(t[18]=e=>E.value=!0)},{prefix:C(()=>[d(r,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):f("",!0),E.value?(o(),k(Ze,{key:3,modelValue:E.value,"onUpdate:modelValue":t[19]||(t[19]=e=>E.value=e),quickEntry:g.value,"onUpdate:quickEntry":t[20]||(t[20]=e=>g.value=e),defaults:c},null,8,["modelValue","quickEntry","defaults"])):f("",!0),R.value?(o(),k(De,{key:4,modelValue:R.value,"onUpdate:modelValue":t[21]||(t[21]=e=>R.value=e),note:J.value,doctype:"CRM Deal",doc:I.value},null,8,["modelValue","note","doc"])):f("",!0),B.value?(o(),k(qe,{key:5,modelValue:B.value,"onUpdate:modelValue":t[22]||(t[22]=e=>B.value=e),task:de.value,doctype:"CRM Deal",doc:I.value},null,8,["modelValue","task","doc"])):f("",!0),g.value?(o(),k(Oe,{key:6,modelValue:g.value,"onUpdate:modelValue":t[23]||(t[23]=e=>g.value=e),doctype:"CRM Deal"},null,8,["modelValue"])):f("",!0)],64)}}};export{oa as default};
//# sourceMappingURL=Deals-5902539e.js.map
