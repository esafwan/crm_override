import{_ as O,a as G}from"./ViewControls-4c2465f0.js";import{_ as K}from"./CustomActions-d045e678.js";import{P as Q}from"./PhoneIcon-3c556b02.js";import{_ as X}from"./LayoutHeader-ce3efb9b.js";import{m as N,i as P,j as B,s as Y,k as E,l as k,r as F,b as n,c as i,d as r,w as c,u as f,F as I,f as T,g as b,n as z,p as L,e as v,t as $,q as ee,C as le,_ as q,v as oe,B as S,D as R,E as te,G as ae,H as ne,I as se,J as W}from"./index-82d0b844.js";import{_ as re,H as j,a as ie,f as ue,b as de,g as ce,c as me,d as pe,e as ve}from"./ListBulkActions-6a63e81f.js";import{b as H,_ as Z}from"./index-8340263f.js";import{D as _e}from"./Dropdown-f8d4a8c8.js";import{_ as fe}from"./ListFooter-621c0d06.js";import{A as ge}from"./ArrowUpRightIcon-60e3a514.js";import{D as Ce,g as J}from"./callLog-0801e3f3.js";import{C as ye}from"./ContactsIcon-bcb3e80b.js";import{L as ke}from"./LeadsIcon-186f8b9f.js";import{D as we}from"./DealsIcon-491a0387.js";import{C as he}from"./CalendarIcon-5c294322.js";import{N as be,_ as Le}from"./NoteModal-fe2f5600.js";import{_ as xe}from"./FadedScrollableDiv-5302c81a.js";import"./GroupByIcon-584f979a.js";import"./Dropdown-57634c86.js";import"./views-5c6870e6.js";import"./NestedPopover-9b04b27b.js";import"./EditIcon-3c54f763.js";import"./PinIcon-d3dd27b0.js";import"./settings-6089b88c.js";import"./DetailsIcon-f2258ff1.js";import"./DragVerticalIcon-71ed262e.js";import"./AssignmentModal-a088aaa9.js";import"./label-16764775.js";import"./contacts-226dfac2.js";const Ve={key:0},$e={key:1},Me=["onClick"],De={key:1,class:"truncate text-base"},Ue={key:2},Fe={key:3},Ie=["onClick"],Ae={__name:"CallLogsListView",props:N({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:N(["loadMore","updatePageCount","columnWidthUpdated","applyFilter","applyLikeFilter","likeDoc"],["update:modelValue","update:list"]),setup(d,{expose:w,emit:u}){const m=u,h=P(d,"modelValue"),C=P(d,"list"),s=B(()=>{var o,t;return!!((t=(o=C.value.params)==null?void 0:o.filters)!=null&&t._liked_by)}),{user:D}=Y();function x(o){if(o)return JSON.parse(o).includes(D)}E(h,(o,t)=>{o!==t&&m("updatePageCount",o)});const _=k(null);return w({customListActions:B(()=>{var o;return(o=_.value)==null?void 0:o.customListActions})}),(o,t)=>{const l=F("Button"),a=F("FeatherIcon"),U=F("Badge"),M=F("FormControl");return n(),i(I,null,[r(f(pe),le({columns:d.columns,rows:d.rows,options:{onRowClick:e=>m("showCallLog",e.name),selectable:d.options.selectable,showTooltip:d.options.showTooltip,resizeColumn:d.options.resizeColumn},"row-key":"name"},o.$attrs),{default:c(()=>[r(f(re),{class:"sm:mx-5 mx-3",onColumnWidthUpdated:t[1]||(t[1]=e=>m("columnWidthUpdated"))},{default:c(()=>[(n(!0),i(I,null,T(d.columns,e=>(n(),b(f(ie),{key:e.key,item:e,onColumnWidthUpdated:y=>m("columnWidthUpdated",e)},{default:c(()=>[e.key=="_liked_by"?(n(),b(l,{key:0,variant:"ghosted",class:z(["!h-4",s.value?"fill-red-500":"fill-white"]),onClick:t[0]||(t[0]=()=>m("applyLikeFilter"))},{default:c(()=>[r(j,{class:"h-4 w-4"})]),_:1},8,["class"])):L("",!0)]),_:2},1032,["item","onColumnWidthUpdated"]))),128))]),_:1}),r(f(ue),{class:"mx-3 sm:mx-5",id:"list-rows"},{default:c(()=>[(n(!0),i(I,null,T(d.rows,e=>(n(),b(f(ce),{key:e.name,row:e},{default:c(({idx:y,column:g,item:p})=>[r(f(de),{item:p},{prefix:c(()=>[["caller","receiver"].includes(g.key)?(n(),i("div",Ve,[p.label?(n(),b(f(H),{key:0,class:"flex items-center",image:p.image,label:p.label,size:"sm"},null,8,["image","label"])):L("",!0)])):["type","duration"].includes(g.key)?(n(),i("div",$e,[r(a,{name:p.icon,class:"h-3 w-3"},null,8,["name"])])):L("",!0)]),default:c(({label:A})=>[["modified","creation"].includes(g.key)?(n(),i("div",{key:0,class:"truncate text-base",onClick:V=>m("applyFilter",{event:V,idx:y,column:g,item:p,firstColumn:d.columns[0]})},[r(f(Z),{text:p.label},{default:c(()=>[v("div",null,$(p.timeAgo),1)]),_:2},1032,["text"])],8,Me)):g.key==="status"?(n(),i("div",De,[r(U,{variant:"subtle",theme:p.color,size:"md",label:o.__(p.label),onClick:V=>m("applyFilter",{event:V,idx:y,column:g,item:p,firstColumn:d.columns[0]})},null,8,["theme","label","onClick"])])):g.type==="Check"?(n(),i("div",Ue,[r(M,{type:"checkbox",modelValue:p,disabled:!0,class:"text-gray-900"},null,8,["modelValue"])])):g.key==="_liked_by"?(n(),i("div",Fe,[g.key=="_liked_by"?(n(),b(l,{key:0,variant:"ghosted",class:z(x(p)?"fill-red-500":"fill-white"),onClick:ee(()=>m("likeDoc",{name:e.name,liked:x(p)}),["stop","prevent"])},{default:c(()=>[r(j,{class:"h-4 w-4"})]),_:2},1032,["class","onClick"])):L("",!0)])):(n(),i("div",{key:4,class:"truncate text-base",onClick:V=>m("applyFilter",{event:V,idx:y,column:g,item:p,firstColumn:d.columns[0]})},$(A),9,Ie))]),_:2},1032,["item"])]),_:2},1032,["row"]))),128))]),_:1}),r(f(me),null,{actions:c(({selections:e,unselectAll:y})=>[r(f(_e),{options:_.value.bulkActions(e,y)},{default:c(()=>[r(l,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])]),_:1})]),_:1},16,["columns","rows","options"]),r(f(fe),{class:"border-t sm:px-5 px-3 py-2",modelValue:h.value,"onUpdate:modelValue":t[2]||(t[2]=e=>h.value=e),options:{rowCount:d.options.rowCount,totalCount:d.options.totalCount},onLoadMore:t[3]||(t[3]=e=>m("loadMore"))},null,8,["modelValue","options"]),r(ve,{ref_key:"listBulkActionsRef",ref:_,modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=e=>C.value=e),doctype:"CRM Call Log",options:{hideEdit:!0,hideAssign:!0}},null,8,["modelValue"])],64)}}},Be={},ze={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Re(d,w){return n(),i("svg",ze,w[0]||(w[0]=[v("g",{"clip-path":"url(#clip0_3668_69185)"},[v("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.25 8C14.25 11.4518 11.4518 14.25 8 14.25C4.54822 14.25 1.75 11.4518 1.75 8C1.75 4.54822 4.54822 1.75 8 1.75C11.4518 1.75 14.25 4.54822 14.25 8ZM15.25 8C15.25 12.0041 12.0041 15.25 8 15.25C3.99594 15.25 0.75 12.0041 0.75 8C0.75 3.99594 3.99594 0.75 8 0.75C12.0041 0.75 15.25 3.99594 15.25 8ZM11.2909 5.98482C11.4666 5.77175 11.4363 5.45663 11.2232 5.28096C11.0101 5.1053 10.695 5.13561 10.5193 5.34868L7.07001 9.53239L5.72845 7.79857C5.55946 7.58018 5.24543 7.54012 5.02703 7.70911C4.80863 7.8781 4.76858 8.19214 4.93756 8.41053L6.66217 10.6394C6.7552 10.7596 6.89788 10.831 7.04988 10.8334C7.20188 10.8357 7.3467 10.7688 7.4434 10.6515L11.2909 5.98482Z",fill:"currentColor"})],-1),v("defs",null,[v("clipPath",{id:"clip0_3668_69185"},[v("rect",{width:"16",height:"16",fill:"white"})])],-1)]))}const Ne=q(Be,[["render",Re]]);const Pe={class:"flex items-center gap-3"},Te={class:"text-2xl font-semibold leading-6 text-gray-900"},He={class:"flex flex-col gap-3.5"},Se={class:"grid size-7 place-content-center"},We={class:"flex min-h-7 w-full items-center gap-2"},je={key:0,class:"flex items-center gap-1"},Ee={class:"ml-1 flex flex-col gap-1"},qe={class:"ml-1 flex flex-col gap-1"},Ze={key:2,class:"w-full"},Je=["src"],Oe=["innerHTML"],Ge=["innerHTML"],Ke={key:5},Qe={__name:"CallLogModal",props:N({name:{type:String,default:{}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(d){const w=d,u=P(d,"modelValue"),m=k(!1),h=oe(),C=k(null),s=k({}),D=B(()=>{var o;return s.value.doc?[{icon:S(R,{name:s.value.doc.type.icon,class:"h-3.5 w-3.5"}),name:"type",value:s.value.doc.type.label+" Call"},{icon:ye,name:"receiver",value:{receiver:s.value.doc.receiver,caller:s.value.doc.caller}},{icon:s.value.doc.reference_doctype=="CRM Lead"?ke:we,name:"reference_doctype",value:s.value.doc.reference_doctype=="CRM Lead"?"Lead":"Deal",link:()=>{s.value.doc.reference_doctype=="CRM Lead"?h.push({name:"Lead",params:{leadId:s.value.doc.reference_docname}}):h.push({name:"Deal",params:{dealId:s.value.doc.reference_docname}})},condition:()=>s.value.doc.reference_docname},{icon:he,name:"creation",value:s.value.doc.creation.label,tooltip:s.value.doc.creation.label},{icon:Ce,name:"duration",value:s.value.doc.duration.label},{icon:Ne,name:"status",value:s.value.doc.status.label,color:s.value.doc.status.color},{icon:S(R,{name:"play-circle",class:"h-4 w-4 mt-2"}),name:"recording_url",value:s.value.doc.recording_url},{icon:be,name:"note",value:(o=C.value)==null?void 0:o.doc}].filter(t=>t.value).filter(t=>t.condition?t.condition():!0):[]});function x(){se("crm.fcrm.doctype.crm_call_log.crm_call_log.create_lead_from_call_log",{call_log:s.value.doc}).then(_=>{_&&h.push({name:"Lead",params:{leadId:_}})})}return E(u,_=>{_&&(s.value=W({doctype:"CRM Call Log",name:w.name,fields:["name","caller","receiver","duration","type","status","from","to","note","recording_url","reference_doctype","reference_docname","creation"],cache:["call_log",w.name],auto:!0,transform:o=>{for(const t in o)o[t]=J(t,o);return o},onSuccess:o=>{if(!o.note){C.value=null;return}C.value=W({doctype:"FCRM Note",name:o.note,fields:["title","content"],cache:["note",o.note],auto:!0})}}))}),(_,o)=>{var a,U,M;const t=F("Button"),l=F("Dialog");return n(),i(I,null,[r(l,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=e=>u.value=e)},te({"body-title":c(()=>[v("div",Pe,[v("h3",Te,$(_.__("Call Details")),1)])]),"body-content":c(()=>[v("div",He,[(n(!0),i(I,null,T(D.value,e=>(n(),i("div",{key:e.name,class:"flex gap-2 text-base text-gray-800"},[v("div",Se,[(n(),b(ae(e.icon)))]),v("div",We,[e.name=="receiver"?(n(),i("div",je,[r(f(H),{image:e.value.caller.image,label:e.value.caller.label,size:"sm"},null,8,["image","label"]),v("div",Ee,$(e.value.caller.label),1),r(f(R),{name:"arrow-right",class:"mx-1 h-4 w-4 text-gray-600"}),r(f(H),{image:e.value.receiver.image,label:e.value.receiver.label,size:"sm"},null,8,["image","label"]),v("div",qe,$(e.value.receiver.label),1)])):e.tooltip?(n(),b(f(Z),{key:1,text:e.tooltip},{default:c(()=>[ne($(e.value),1)]),_:2},1032,["text"])):e.name=="recording_url"?(n(),i("div",Ze,[v("audio",{class:"audio-control w-full",controls:"",src:e.value},null,8,Je)])):e.name=="note"?(n(),i("div",{key:3,class:"w-full cursor-pointer rounded border px-2 pt-1.5 text-base text-gray-700",onClick:o[0]||(o[0]=()=>m.value=!0)},[r(xe,{class:"max-h-24 min-h-16 overflow-y-auto"},{default:c(()=>{var y,g,p,A,V;return[(y=e.value)!=null&&y.title?(n(),i("div",{key:0,class:z([(g=e.value)!=null&&g.content?"mb-1 font-bold":""]),innerHTML:(p=e.value)==null?void 0:p.title},null,10,Oe)):L("",!0),(A=e.value)!=null&&A.content?(n(),i("div",{key:1,innerHTML:(V=e.value)==null?void 0:V.content},null,8,Ge)):L("",!0)]}),_:2},1024)])):(n(),i("div",{key:4,class:z(e.color?`text-${e.color}-600`:"")},$(e.value),3)),e.link?(n(),i("div",Ke,[r(ge,{class:"h-4 w-4 shrink-0 cursor-pointer text-gray-600 hover:text-gray-800",onClick:()=>e.link()},null,8,["onClick"])])):L("",!0)])]))),128))])]),_:2},[((a=s.value.doc)==null?void 0:a.type.label)=="Incoming"&&!((U=s.value.doc)!=null&&U.reference_docname)?{name:"actions",fn:c(()=>[r(t,{class:"w-full",variant:"solid",label:_.__("Create lead"),onClick:x},null,8,["label"])]),key:"0"}:void 0]),1032,["modelValue"]),r(Le,{modelValue:m.value,"onUpdate:modelValue":o[2]||(o[2]=e=>m.value=e),note:(M=C.value)==null?void 0:M.doc},null,8,["modelValue","note"])],64)}}},Xe=q(Qe,[["__scopeId","data-v-f1ebee8d"]]),Ye={key:1,class:"flex h-full items-center justify-center"},el={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},Ul={__name:"CallLogs",setup(d){const w=k(null),u=k({}),m=k(1),h=k(1),C=k(20),s=k(null),D=B(()=>{var t,l,a;return!((l=(t=u.value)==null?void 0:t.data)!=null&&l.data)||!["list","group_by"].includes(u.value.data.view_type)?[]:(a=u.value)==null?void 0:a.data.data.map(U=>{var e;let M={};return(e=u.value)==null||e.data.rows.forEach(y=>{M[y]=J(y,U)}),M})}),x=k(!1),_=k(null);function o(t){_.value=t,x.value=!0}return(t,l)=>(n(),i(I,null,[r(X,null,{"left-header":c(()=>[r(G,{modelValue:s.value,"onUpdate:modelValue":l[0]||(l[0]=a=>s.value=a),routeName:"Call Logs"},null,8,["modelValue"])]),"right-header":c(()=>{var a;return[(a=w.value)!=null&&a.customListActions?(n(),b(K,{key:0,actions:w.value.customListActions},null,8,["actions"])):L("",!0)]}),_:1}),r(O,{ref_key:"viewControls",ref:s,modelValue:u.value,"onUpdate:modelValue":l[1]||(l[1]=a=>u.value=a),loadMore:m.value,"onUpdate:loadMore":l[2]||(l[2]=a=>m.value=a),resizeColumn:h.value,"onUpdate:resizeColumn":l[3]||(l[3]=a=>h.value=a),updatedPageCount:C.value,"onUpdate:updatedPageCount":l[4]||(l[4]=a=>C.value=a),doctype:"CRM Call Log"},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),u.value.data&&D.value.length?(n(),b(Ae,{key:0,ref_key:"callLogsListView",ref:w,modelValue:u.value.data.page_length_count,"onUpdate:modelValue":l[5]||(l[5]=a=>u.value.data.page_length_count=a),list:u.value,"onUpdate:list":l[6]||(l[6]=a=>u.value=a),rows:D.value,columns:u.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:u.value.data.row_count,totalCount:u.value.data.total_count},onShowCallLog:o,onLoadMore:l[7]||(l[7]=()=>m.value++),onColumnWidthUpdated:l[8]||(l[8]=()=>h.value++),onUpdatePageCount:l[9]||(l[9]=a=>C.value=a),onApplyFilter:l[10]||(l[10]=a=>s.value.applyFilter(a)),onApplyLikeFilter:l[11]||(l[11]=a=>s.value.applyLikeFilter(a)),onLikeDoc:l[12]||(l[12]=a=>s.value.likeDoc(a))},null,8,["modelValue","list","rows","columns","options"])):u.value.data?(n(),i("div",Ye,[v("div",el,[r(Q,{class:"h-10 w-10"}),v("span",null,$(t.__("No {0} Found",[t.__("Logs")])),1)])])):L("",!0),r(Xe,{modelValue:x.value,"onUpdate:modelValue":l[13]||(l[13]=a=>x.value=a),name:_.value},null,8,["modelValue","name"])],64))}};export{Ul as default};
//# sourceMappingURL=CallLogs-416d1005.js.map
