import{_ as pe}from"./GroupByIcon-584f979a.js";import{_ as fe,a as ve,L as ge}from"./SidePanelModal-490a8763.js";import{E as be}from"./EditIcon-3c54f763.js";import{A as ye,E as Ce,_ as xe,S as we,a as he}from"./SLASection-72cc8d88.js";import{E as ke}from"./Email2Icon-c181bc5b.js";import{C as Ie}from"./CommentIcon-fd4d721b.js";import{P as W}from"./PhoneIcon-3c556b02.js";import{T as Ve}from"./TaskIcon-5ecf8abe.js";import{N as Le}from"./NoteModal-fe2f5600.js";import{W as ze}from"./WhatsAppIcon-67297c1d.js";import{I as Ee}from"./IndicatorIcon-d1b8f59f.js";import{C as $e}from"./CameraIcon-882f4582.js";import{O as Ue}from"./OrganizationsIcon-557bc8d4.js";import{C as Se}from"./ContactsIcon-bcb3e80b.js";import{_ as Ae}from"./LayoutHeader-ce3efb9b.js";import{_ as Me}from"./AssignmentModal-a088aaa9.js";import{s as Ne,_ as Te}from"./statuses-3dacf993.js";import{_ as G}from"./views-5c6870e6.js";import{_ as Re}from"./Section-2652928e.js";import{_ as De}from"./CustomActions-d045e678.js";import{g as je,u as qe,s as Be,h as Fe,i as Oe,j as w,k as Pe,b as We,_ as A,l as D,o as Ge}from"./index-8340263f.js";import{g as Je,_ as Ke}from"./view-eb7d1a47.js";import{c as He}from"./contacts-226dfac2.js";import{o as Qe}from"./organizations-c51d501b.js";import{c as J,w as Xe}from"./settings-6089b88c.js";import{h as Ye,v as Ze,x as j,a as ea,l as _,j as K,K as aa,k as ta,r as M,b as i,c as b,u as a,g as c,w as n,p as f,d as l,F as H,I as q,z as oa,G as Q,n as X,L as sa,e as r,t as g,C as la,f as na,E as ia}from"./index-82d0b844.js";import{_ as ra}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-cd1be04a.js";import{D as Y}from"./Dropdown-f8d4a8c8.js";import{F as da}from"./FileUploader-b4f98b38.js";import{_ as Z}from"./Switch.vue_vue_type_script_setup_true_lang-d07933ba.js";import"./DragVerticalIcon-71ed262e.js";import"./CalendarIcon-5c294322.js";import"./callLog-0801e3f3.js";import"./Dropdown-57634c86.js";import"./FadedScrollableDiv-5302c81a.js";import"./LeadsIcon-186f8b9f.js";import"./DealsIcon-491a0387.js";import"./EmailTemplateModal-77cc8111.js";import"./TaskModal-16274f1c.js";import"./ArrowUpRightIcon-60e3a514.js";import"./label-16764775.js";const ma={key:1,class:"flex h-full overflow-hidden"},ua={class:"flex items-center justify-start gap-5 border-b p-5"},ca={class:"group relative size-12"},_a={class:"z-1 absolute bottom-0.5 left-0 right-0.5 flex h-9 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},pa={class:"flex flex-col gap-2.5 truncate"},fa={class:"truncate text-2xl font-medium"},va={class:"flex gap-1.5"},ga={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},ba={class:"flex flex-col overflow-y-auto"},ya={class:"mb-4 flex items-center gap-2 text-gray-600"},Ca={class:"block text-base"},xa={class:"ml-6"},wa={class:"flex items-center justify-between text-base"},ha={key:1,class:"mt-2.5 text-base"},ka={class:"mb-4 mt-6 flex items-center gap-2 text-gray-600"},Ia={class:"block text-base"},Va={class:"ml-6"},La={class:"flex items-center justify-between text-base"},za={key:1,class:"mt-2.5 text-base"},vt={__name:"Lead",props:{leadId:{type:String,required:!0}},setup(ee){const{$dialog:ae,makeCall:te}=je(),{getContactByName:h,contacts:oe}=He(),{organizations:se}=Qe(),{statusOptions:le,getLeadStatus:ne}=Ne(),{isManager:ie}=qe(),v=Ye(),N=Ze(),k=ee,t=j({url:"crm.fcrm.doctype.crm_lead.api.get_lead",params:{name:k.leadId},cache:["lead",k.leadId],onSuccess:o=>{let e={doc:o,$dialog:ae,router:N,updateField:y,createToast:w,deleteDoc:ue,call:q};Be(o),Fe(o,e),Oe(o,e)}});ea(()=>{t.data||t.fetch()});const T=_(!1),L=_(!1),z=_(!1);function B(o,e,d){e=Array.isArray(o)?"":e,!(!Array.isArray(o)&&re(o,e))&&j({url:"frappe.client.set_value",params:{doctype:"CRM Lead",name:k.leadId,fieldname:o,value:e},auto:!0,onSuccess:()=>{t.reload(),T.value=!0,w({title:__("Lead updated"),icon:"check",iconClasses:"text-green-600"}),d==null||d()},onError:u=>{var U;w({title:__("Error updating lead"),text:__((U=u.messages)==null?void 0:U[0]),icon:"x",iconClasses:"text-red-600"})}})}function re(o,e){var u;let d=t.data.fields_meta||{};return(u=d[o])!=null&&u.reqd&&!e?(w({title:__("Error Updating Lead"),text:__("{0} is a required field",[d[o].label]),icon:"x",iconClasses:"text-red-600"}),!0):!1}const de=K(()=>{let o=[{label:__("Leads"),route:{name:"Leads"}}];if(v.query.view||v.query.viewType){let e=Je(v.query.view,v.query.viewType,"CRM Lead");e&&o.push({label:__(e.label),icon:e.icon,route:{name:"Leads",params:{viewType:v.query.viewType},query:{view:v.query.view}}})}return o.push({label:t.data.lead_name||__("Untitled"),route:{name:"Lead",params:{leadId:t.data.name}}}),o});aa(()=>{var o,e;return{title:((o=t.data)==null?void 0:o.lead_name)||((e=t.data)==null?void 0:e.name)}});const I=_(0),R=K(()=>[{name:"Activity",label:__("Activity"),icon:ye},{name:"Emails",label:__("Emails"),icon:Ce},{name:"Comments",label:__("Comments"),icon:Ie},{name:"Calls",label:__("Calls"),icon:W,condition:()=>J.value},{name:"Tasks",label:__("Tasks"),icon:Ve},{name:"Notes",label:__("Notes"),icon:Le},{name:"WhatsApp",label:__("WhatsApp"),icon:ze,condition:()=>Xe.value}].filter(e=>e.condition?e.condition():!0));ta(R,o=>{if(o&&v.params.tabName){let e=o.findIndex(d=>d.name.toLowerCase()===v.params.tabName.toLowerCase());e!==-1&&(I.value=e)}});function me(o){let e=o.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(e))return __("Only PNG and JPG images are allowed")}const E=j({url:"crm.api.doc.get_sidebar_fields",cache:["fieldsLayout",k.leadId],params:{doctype:"CRM Lead",name:k.leadId},auto:!0});function y(o,e,d){B(o,e,()=>{t.data[o]=e,d==null||d()})}async function ue(o){await q("frappe.client.delete",{doctype:"CRM Lead",name:o}),N.push({name:"Leads"})}const $=_(!1),C=_(!1),x=_(!1),p=_(""),V=_("");async function F(o){let e=!1;if(C.value&&!p.value){w({title:__("Error"),text:__("Please select an existing contact"),icon:"x",iconClasses:"text-red-600"});return}if(x.value&&!V.value){w({title:__("Error"),text:__("Please select an existing organization"),icon:"x",iconClasses:"text-red-600"});return}if(C.value&&p.value&&(t.data.salutation=h(p.value).salutation,t.data.first_name=h(p.value).first_name,t.data.last_name=h(p.value).last_name,t.data.email_id=h(p.value).email_id,t.data.mobile_no=h(p.value).mobile_no,C.value=!1,e=!0),x.value&&V.value&&(t.data.organization=V.value,x.value=!1,e=!0),e)B({salutation:t.data.salutation,first_name:t.data.first_name,last_name:t.data.last_name,email_id:t.data.email_id,mobile_no:t.data.mobile_no,organization:t.data.organization},"",()=>F(!0)),$.value=!1;else{let d=await q("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:t.data.name});d&&(oa("convert_lead_to_deal"),o&&(await se.reload(),await oe.reload()),N.push({name:"Deal",params:{dealId:d}}))}}const O=_(null);function ce(){O.value.emailBox.show=!0}return(o,e)=>{var P;const d=M("FeatherIcon"),u=M("Button"),U=M("ErrorMessage"),_e=M("Dialog");return i(),b(H,null,[a(t).data?(i(),c(Ae,{key:0},{"left-header":n(()=>[l(a(ra),{items:de.value},{prefix:n(({item:s})=>[s.icon?(i(),c(pe,{key:0,icon:s.icon,class:"mr-2 h-4"},null,8,["icon"])):f("",!0)]),_:1},8,["items"])]),"right-header":n(()=>{var s;return[a(t).data._customActions?(i(),c(De,{key:0,actions:a(t).data._customActions},null,8,["actions"])):f("",!0),(i(),c(Q(((s=a(t).data._assignedTo)==null?void 0:s.length)==1?"Button":"div"),null,{default:n(()=>[l(Te,{avatars:a(t).data._assignedTo,onClick:e[0]||(e[0]=m=>L.value=!0)},null,8,["avatars"])]),_:1})),l(a(Y),{options:a(le)("lead",y,a(t).data._customStatuses)},{default:n(({open:m})=>[l(u,{label:a(t).data.status,class:X(a(ne)(a(t).data.status).colorClass)},{prefix:n(()=>[l(Ee)]),suffix:n(()=>[l(d,{name:m?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label","class"])]),_:1},8,["options"]),l(u,{label:o.__("Convert to Deal"),variant:"solid",onClick:e[1]||(e[1]=m=>$.value=!0)},null,8,["label"])]}),_:1})):f("",!0),(P=a(t))!=null&&P.data?(i(),b("div",ma,[l(a(Ke),{modelValue:I.value,"onUpdate:modelValue":e[5]||(e[5]=s=>I.value=s),tabs:R.value},{default:n(({tab:s})=>[l(xe,{ref_key:"activities",ref:O,doctype:"CRM Lead",title:s.name,tabs:R.value,reload:T.value,"onUpdate:reload":e[2]||(e[2]=m=>T.value=m),tabIndex:I.value,"onUpdate:tabIndex":e[3]||(e[3]=m=>I.value=m),modelValue:a(t),"onUpdate:modelValue":e[4]||(e[4]=m=>sa(t)?t.value=m:null)},null,8,["title","tabs","reload","tabIndex","modelValue"])]),_:1},8,["modelValue","tabs"]),l(fe,{class:"flex flex-col justify-between border-l",side:"right"},{default:n(()=>[r("div",{class:"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium",onClick:e[6]||(e[6]=s=>a(Pe)(a(t).data.name))},g(o.__(a(t).data.name)),1),l(a(da),{onSuccess:e[10]||(e[10]=s=>y("image",s.file_url)),validateFile:me},{default:n(({openFileSelector:s,error:m})=>[r("div",ua,[r("div",ca,[l(a(We),{size:"3xl",class:"size-12",label:a(t).data.first_name||o.__("Untitled"),image:a(t).data.image},null,8,["label","image"]),(i(),c(Q(a(t).data.image?a(Y):"div"),la(a(t).data.image?{options:[{icon:"upload",label:a(t).data.image?o.__("Change image"):o.__("Upload image"),onClick:s},{icon:"trash-2",label:o.__("Remove image"),onClick:()=>y("image","")}]}:{onClick:s},{class:"!absolute bottom-0 left-0 right-0"}),{default:n(()=>[r("div",_a,[l($e,{class:"size-4 cursor-pointer text-white"})])]),_:2},1040))]),r("div",pa,[l(a(A),{text:a(t).data.lead_name||o.__("Set first name")},{default:n(()=>[r("div",fa,g(a(t).data.lead_name||o.__("Untitled")),1)]),_:1},8,["text"]),r("div",va,[a(J)?(i(),c(a(A),{key:0,text:o.__("Make a call")},{default:n(()=>[l(u,{class:"h-7 w-7",onClick:e[7]||(e[7]=()=>a(t).data.mobile_no?a(te)(a(t).data.mobile_no):a(D)(o.__("No phone number set")))},{default:n(()=>[l(W,{class:"h-4 w-4"})]),_:1})]),_:1},8,["text"])):f("",!0),l(a(A),{text:o.__("Send an email")},{default:n(()=>[l(u,{class:"h-7 w-7"},{default:n(()=>[l(ke,{class:"h-4 w-4",onClick:e[8]||(e[8]=S=>a(t).data.email?ce():a(D)(o.__("No email set")))})]),_:1})]),_:1},8,["text"]),l(a(A),{text:o.__("Go to website")},{default:n(()=>[l(u,{class:"h-7 w-7"},{default:n(()=>[l(ge,{class:"h-4 w-4",onClick:e[9]||(e[9]=S=>a(t).data.website?a(Ge)(a(t).data.website):a(D)(o.__("No website set")))})]),_:1})]),_:1},8,["text"])]),l(U,{message:o.__(m)},null,8,["message"])])])]),_:1}),a(t).data.sla_status?(i(),c(we,{key:0,modelValue:a(t).data,"onUpdate:modelValue":e[11]||(e[11]=s=>a(t).data=s),onUpdateField:y},null,8,["modelValue"])):f("",!0),a(E).data?(i(),b("div",ga,[r("div",ba,[(i(!0),b(H,null,na(a(E).data,(s,m)=>(i(),b("div",{key:s.label,class:X(["flex flex-col p-3",{"border-b":m!==a(E).data.length-1}])},[l(Re,{"is-opened":s.opened,label:s.label},ia({default:n(()=>[l(he,{fields:s.fields,modelValue:a(t).data,"onUpdate:modelValue":e[12]||(e[12]=S=>a(t).data=S),onUpdate:y},null,8,["fields","modelValue"])]),_:2},[m==0&&a(ie)()?{name:"actions",fn:n(()=>[l(u,{variant:"ghost",class:"w-7 mr-2",onClick:e[13]||(e[13]=S=>z.value=!0)},{default:n(()=>[l(be,{class:"h-4 w-4"})]),_:1})]),key:"0"}:void 0]),1032,["is-opened","label"])],2))),128))])])):f("",!0)]),_:1})])):f("",!0),L.value?(i(),c(Me,{key:2,modelValue:L.value,"onUpdate:modelValue":e[14]||(e[14]=s=>L.value=s),assignees:a(t).data._assignedTo,"onUpdate:assignees":e[15]||(e[15]=s=>a(t).data._assignedTo=s),doc:a(t).data,doctype:"CRM Lead"},null,8,["modelValue","assignees","doc"])):f("",!0),l(_e,{modelValue:$.value,"onUpdate:modelValue":e[20]||(e[20]=s=>$.value=s),options:{title:o.__("Convert to Deal"),size:"xl",actions:[{label:o.__("Convert"),variant:"solid",onClick:F}]}},{"body-content":n(()=>[r("div",ya,[l(Ue,{class:"h-4 w-4"}),r("label",Ca,g(o.__("Organization")),1)]),r("div",xa,[r("div",wa,[r("div",null,g(o.__("Choose Existing")),1),l(a(Z),{modelValue:x.value,"onUpdate:modelValue":e[16]||(e[16]=s=>x.value=s)},null,8,["modelValue"])]),x.value?(i(),c(G,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:V.value,doctype:"CRM Organization",onChange:e[17]||(e[17]=s=>V.value=s)},null,8,["value"])):(i(),b("div",ha,g(o.__("New organization will be created based on the data in details section")),1))]),r("div",ka,[l(Se,{class:"h-4 w-4"}),r("label",Ia,g(o.__("Contact")),1)]),r("div",Va,[r("div",La,[r("div",null,g(o.__("Choose Existing")),1),l(a(Z),{modelValue:C.value,"onUpdate:modelValue":e[18]||(e[18]=s=>C.value=s)},null,8,["modelValue"])]),C.value?(i(),c(G,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:p.value,doctype:"Contact",onChange:e[19]||(e[19]=s=>p.value=s)},null,8,["value"])):(i(),b("div",za,g(o.__("New contact will be created based on the person's details")),1))])]),_:1},8,["modelValue","options"]),z.value?(i(),c(ve,{key:3,modelValue:z.value,"onUpdate:modelValue":e[21]||(e[21]=s=>z.value=s),onReload:e[22]||(e[22]=()=>a(E).reload())},null,8,["modelValue"])):f("",!0)],64)}}};export{vt as default};
//# sourceMappingURL=Lead-cf4c1b61.js.map
