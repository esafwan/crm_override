{"version":3,"file":"NoteModal-fe2f5600.js","sources":["../../../../frontend/src/components/Icons/NoteIcon.vue","../../../../frontend/src/components/Modals/NoteModal.vue"],"sourcesContent":["<template>\n  <svg\n    width=\"16\"\n    height=\"16\"\n    viewBox=\"0 0 16 16\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M3.99707 14H11.9971C12.8255 14 13.4971 13.3284 13.4971 12.5V6.49988L12 6.49989C10.6193 6.4999 9.5 5.38061 9.5 3.99989V2H3.99707C3.16864 2 2.49707 2.67157 2.49707 3.5V12.5C2.49707 13.3284 3.16864 14 3.99707 14ZM13.8291 4.2806C14.1476 4.62366 14.3612 5.04668 14.4502 5.49987L14.4968 5.49987L14.4968 5.94777L14.4971 5.98173V12.5C14.4971 13.8807 13.3778 15 11.9971 15H3.99707C2.61636 15 1.49707 13.8807 1.49707 12.5V3.5C1.49707 2.11929 2.61636 1 3.99707 1H9.69261C10.3878 1 11.0516 1.28945 11.5246 1.79887L13.8291 4.2806ZM12 5.49989L13.4176 5.49988C13.3502 5.30132 13.2414 5.11735 13.0963 4.96105L10.7918 2.47932C10.7044 2.38525 10.6063 2.30368 10.5 2.23582V3.99989C10.5 4.82832 11.1716 5.4999 12 5.49989ZM5 11C4.72386 11 4.5 11.2239 4.5 11.5C4.5 11.7761 4.72386 12 5 12H8C8.27614 12 8.5 11.7761 8.5 11.5C8.5 11.2239 8.27614 11 8 11H5ZM10 9.5H5H4.75C4.47386 9.5 4.25 9.27614 4.25 9C4.25 8.72386 4.47386 8.5 4.75 8.5H5H10H11.25C11.5261 8.5 11.75 8.72386 11.75 9C11.75 9.27614 11.5261 9.5 11.25 9.5H10Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n</template>\n","<template>\n  <Dialog\n    v-model=\"show\"\n    :options=\"{\n      size: 'xl',\n      actions: [\n        {\n          label: editMode ? __('Update') : __('Create'),\n          variant: 'solid',\n          onClick: () => updateNote(),\n        },\n      ],\n    }\"\n  >\n    <template #body-title>\n      <div class=\"flex items-center gap-3\">\n        <h3 class=\"text-2xl font-semibold leading-6 text-gray-900\">\n          {{ editMode ? __('Edit Note') : __('Create Note') }}\n        </h3>\n        <Button\n          v-if=\"_note?.reference_docname\"\n          variant=\"outline\"\n          size=\"sm\"\n          :label=\"\n            _note.reference_doctype == 'CRM Deal'\n              ? __('Open Deal')\n              : __('Open Lead')\n          \"\n          @click=\"redirect()\"\n        >\n          <template #suffix>\n            <ArrowUpRightIcon class=\"h-4 w-4\" />\n          </template>\n        </Button>\n      </div>\n    </template>\n    <template #body-content>\n      <div class=\"flex flex-col gap-4\">\n        <div>\n          <div class=\"mb-1.5 text-sm text-gray-600\">{{ __('Title') }}</div>\n          <TextInput\n            ref=\"title\"\n            variant=\"outline\"\n            v-model=\"_note.title\"\n            :placeholder=\"__('Call with John Doe')\"\n          />\n        </div>\n        <div>\n          <div class=\"mb-1.5 text-sm text-gray-600\">{{ __('Content') }}</div>\n          <TextEditor\n            variant=\"outline\"\n            ref=\"content\"\n            editor-class=\"!prose-sm overflow-auto min-h-[180px] max-h-80 py-1.5 px-2 rounded border border-gray-300 bg-white hover:border-gray-400 hover:shadow-sm focus:bg-white focus:border-gray-500 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-gray-400 text-gray-800 transition-colors\"\n            :bubbleMenu=\"true\"\n            :content=\"_note.content\"\n            @change=\"(val) => (_note.content = val)\"\n            :placeholder=\"\n              __('Took a call with John Doe and discussed the new project.')\n            \"\n          />\n        </div>\n      </div>\n    </template>\n  </Dialog>\n</template>\n\n<script setup>\nimport ArrowUpRightIcon from '@/components/Icons/ArrowUpRightIcon.vue'\nimport { capture } from '@/telemetry'\nimport { TextEditor, call } from 'frappe-ui'\nimport { ref, nextTick, watch } from 'vue'\nimport { useRouter } from 'vue-router'\n\nconst props = defineProps({\n  note: {\n    type: Object,\n    default: {},\n  },\n  doctype: {\n    type: String,\n    default: 'CRM Lead',\n  },\n  doc: {\n    type: String,\n    default: '',\n  },\n})\n\nconst show = defineModel()\nconst notes = defineModel('reloadNotes')\n\nconst emit = defineEmits(['after'])\n\nconst router = useRouter()\n\nconst title = ref(null)\nconst editMode = ref(false)\nlet _note = ref({})\n\nasync function updateNote() {\n  if (\n    props.note.title === _note.value.title &&\n    props.note.content === _note.value.content\n  )\n    return\n\n  if (_note.value.name) {\n    let d = await call('frappe.client.set_value', {\n      doctype: 'FCRM Note',\n      name: _note.value.name,\n      fieldname: _note.value,\n    })\n    if (d.name) {\n      notes.value?.reload()\n      emit('after', d)\n    }\n  } else {\n    let d = await call('frappe.client.insert', {\n      doc: {\n        doctype: 'FCRM Note',\n        title: _note.value.title,\n        content: _note.value.content,\n        reference_doctype: props.doctype,\n        reference_docname: props.doc || '',\n      },\n    })\n    if (d.name) {\n      capture('note_created')\n      notes.value?.reload()\n      emit('after', d, true)\n    }\n  }\n  show.value = false\n}\n\nfunction redirect() {\n  if (!props.note?.reference_docname) return\n  let name = props.note.reference_doctype == 'CRM Deal' ? 'Deal' : 'Lead'\n  let params = { leadId: props.note.reference_docname }\n  if (name == 'Deal') {\n    params = { dealId: props.note.reference_docname }\n  }\n  router.push({ name: name, params: params })\n}\n\nwatch(\n  () => show.value,\n  (value) => {\n    if (!value) return\n    editMode.value = false\n    nextTick(() => {\n      title.value.el.focus()\n      _note.value = { ...props.note }\n      if (_note.value.title || _note.value.content) {\n        editMode.value = true\n      }\n    })\n  }\n)\n</script>\n"],"names":["_hoisted_1","_sfc_render","_ctx","_cache","_openBlock","_createElementBlock","_createElementVNode","props","__props","show","_useModel","notes","emit","__emit","router","useRouter","title","ref","editMode","_note","updateNote","d","call","_a","capture","_b","redirect","name","params","watch","value","nextTick"],"mappings":"4QAEIA,EAAU,CACV,WACA,YACA,QAAW,YACX,gDALF,SAAAC,EAAAC,EAAAC,EAAA,QAYIC,EAAA,EAAAC,EAAA,MAAAL,EAAAG,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAJAG,EAAmB,OAAA,CACnB,YAAU,UACV,YAAw+B,UACx+B,EAAA,mhDC6DN,MAAMC,EAAQC,EAeRC,EAAOC,gBAAY,EACnBC,EAAQD,EAAYF,EAAA,aAAa,EAEjCI,EAAOC,EAEPC,EAASC,EAAW,EAEpBC,EAAQC,EAAI,IAAI,EAChBC,EAAWD,EAAI,EAAK,EAC1B,IAAIE,EAAQF,EAAI,EAAE,EAElB,eAAeG,GAAa,SAC1B,GACE,EAAAb,EAAM,KAAK,QAAUY,EAAM,MAAM,OACjCZ,EAAM,KAAK,UAAYY,EAAM,MAAM,SAIrC,IAAIA,EAAM,MAAM,KAAM,CACpB,IAAIE,EAAI,MAAMC,EAAK,0BAA2B,CAC5C,QAAS,YACT,KAAMH,EAAM,MAAM,KAClB,UAAWA,EAAM,KACvB,CAAK,EACGE,EAAE,QACJE,EAAAZ,EAAM,QAAN,MAAAY,EAAa,SACbX,EAAK,QAASS,CAAC,EAErB,KAAS,CACL,IAAIA,EAAI,MAAMC,EAAK,uBAAwB,CACzC,IAAK,CACH,QAAS,YACT,MAAOH,EAAM,MAAM,MACnB,QAASA,EAAM,MAAM,QACrB,kBAAmBZ,EAAM,QACzB,kBAAmBA,EAAM,KAAO,EACjC,CACP,CAAK,EACGc,EAAE,OACJG,EAAQ,cAAc,GACtBC,EAAAd,EAAM,QAAN,MAAAc,EAAa,SACbb,EAAK,QAASS,EAAG,EAAI,EAExB,CACDZ,EAAK,MAAQ,GACf,CAEA,SAASiB,GAAW,OAClB,GAAI,GAACH,EAAAhB,EAAM,OAAN,MAAAgB,EAAY,mBAAmB,OACpC,IAAII,EAAOpB,EAAM,KAAK,mBAAqB,WAAa,OAAS,OAC7DqB,EAAS,CAAE,OAAQrB,EAAM,KAAK,iBAAmB,EACjDoB,GAAQ,SACVC,EAAS,CAAE,OAAQrB,EAAM,KAAK,iBAAmB,GAEnDO,EAAO,KAAK,CAAE,KAAMa,EAAM,OAAQC,EAAQ,CAC5C,CAEA,OAAAC,EACE,IAAMpB,EAAK,MACVqB,GAAU,CACJA,IACLZ,EAAS,MAAQ,GACjBa,EAAS,IAAM,CACbf,EAAM,MAAM,GAAG,MAAO,EACtBG,EAAM,MAAQ,CAAE,GAAGZ,EAAM,IAAM,GAC3BY,EAAM,MAAM,OAASA,EAAM,MAAM,WACnCD,EAAS,MAAQ,GAEzB,CAAK,EACF,CACH"}