{"version":3,"file":"Contact-df897214.js","sources":["../../../../frontend/src/pages/Contact.vue"],"sourcesContent":["<template>\n  <LayoutHeader v-if=\"contact.data\">\n    <template #left-header>\n      <Breadcrumbs :items=\"breadcrumbs\">\n        <template #prefix=\"{ item }\">\n          <Icon v-if=\"item.icon\" :icon=\"item.icon\" class=\"mr-2 h-4\" />\n        </template>\n      </Breadcrumbs>\n    </template>\n  </LayoutHeader>\n  <div v-if=\"contact.data\" class=\"flex h-full flex-col overflow-hidden\">\n    <FileUploader @success=\"changeContactImage\" :validateFile=\"validateFile\">\n      <template #default=\"{ openFileSelector, error }\">\n        <div class=\"flex items-start justify-start gap-6 p-5 sm:items-center\">\n          <div class=\"group relative h-24 w-24\">\n            <Avatar\n              size=\"3xl\"\n              class=\"h-24 w-24\"\n              :label=\"contact.data.full_name\"\n              :image=\"contact.data.image\"\n            />\n            <component\n              :is=\"contact.data.image ? Dropdown : 'div'\"\n              v-bind=\"\n                contact.data.image\n                  ? {\n                      options: [\n                        {\n                          icon: 'upload',\n                          label: contact.data.image\n                            ? __('Change image')\n                            : __('Upload image'),\n                          onClick: openFileSelector,\n                        },\n                        {\n                          icon: 'trash-2',\n                          label: __('Remove image'),\n                          onClick: () => changeContactImage(''),\n                        },\n                      ],\n                    }\n                  : { onClick: openFileSelector }\n              \"\n              class=\"!absolute bottom-0 left-0 right-0\"\n            >\n              <div\n                class=\"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100\"\n                style=\"\n                  -webkit-clip-path: inset(12px 0 0 0);\n                  clip-path: inset(12px 0 0 0);\n                \"\n              >\n                <CameraIcon class=\"h-6 w-6 cursor-pointer text-white\" />\n              </div>\n            </component>\n          </div>\n          <div class=\"flex flex-col gap-2 truncate sm:gap-0.5\">\n            <div class=\"truncate text-3xl font-semibold\">\n              <span v-if=\"contact.data.salutation\">\n                {{ contact.data.salutation + '. ' }}\n              </span>\n              <span>{{ contact.data.full_name }}</span>\n            </div>\n            <div\n              class=\"flex flex-col flex-wrap gap-3 text-base text-gray-700 sm:flex-row sm:items-center sm:gap-2\"\n            >\n              <div\n                v-if=\"contact.data.email_id\"\n                class=\"flex items-center gap-1.5\"\n              >\n                <Email2Icon class=\"h-4 w-4\" />\n                <span class=\"\">{{ contact.data.email_id }}</span>\n              </div>\n              <span\n                v-if=\"contact.data.email_id\"\n                class=\"hidden text-3xl leading-[0] text-gray-600 sm:flex\"\n              >\n                &middot;\n              </span>\n              <component\n                :is=\"callEnabled ? Tooltip : 'div'\"\n                :text=\"__('Make Call')\"\n                v-if=\"contact.data.actual_mobile_no\"\n              >\n                <div\n                  class=\"flex items-center gap-1.5\"\n                  :class=\"callEnabled ? 'cursor-pointer' : ''\"\n                  @click=\"\n                    callEnabled && makeCall(contact.data.actual_mobile_no)\n                  \"\n                >\n                  <PhoneIcon class=\"h-4 w-4\" />\n                  <span class=\"\">{{ contact.data.actual_mobile_no }}</span>\n                </div>\n              </component>\n              <span\n                v-if=\"contact.data.actual_mobile_no\"\n                class=\"hidden text-3xl leading-[0] text-gray-600 sm:flex\"\n              >\n                &middot;\n              </span>\n              <div\n                v-if=\"contact.data.company_name\"\n                class=\"flex items-center gap-1.5\"\n              >\n                <Avatar\n                  size=\"xs\"\n                  :label=\"contact.data.company_name\"\n                  :image=\"\n                    getOrganization(contact.data.company_name)\n                      ?.organization_logo\n                  \"\n                />\n                <span class=\"\">{{ contact.data.company_name }}</span>\n              </div>\n              <span\n                v-if=\"contact.data.company_name\"\n                class=\"hidden text-3xl leading-[0] text-gray-600 sm:flex\"\n              >\n                &middot;\n              </span>\n              <Button\n                v-if=\"\n                  contact.data.email_id ||\n                  contact.data.mobile_no ||\n                  contact.data.company_name\n                \"\n                variant=\"ghost\"\n                :label=\"__('More')\"\n                class=\"w-fit cursor-pointer hover:text-gray-900 sm:-ml-1\"\n                @click=\"\n                  () => {\n                    detailMode = true\n                    showContactModal = true\n                  }\n                \"\n              />\n            </div>\n            <div class=\"mt-2 flex gap-1.5\">\n              <Button\n                :label=\"__('Edit')\"\n                size=\"sm\"\n                @click=\"\n                  () => {\n                    detailMode = false\n                    showContactModal = true\n                  }\n                \"\n              >\n                <template #prefix>\n                  <EditIcon class=\"h-4 w-4\" />\n                </template>\n              </Button>\n              <Button\n                :label=\"__('Delete')\"\n                theme=\"red\"\n                size=\"sm\"\n                @click=\"deleteContact\"\n              >\n                <template #prefix>\n                  <FeatherIcon name=\"trash-2\" class=\"h-4 w-4\" />\n                </template>\n              </Button>\n            </div>\n            <ErrorMessage :message=\"__(error)\" />\n          </div>\n        </div>\n      </template>\n    </FileUploader>\n    <Tabs class=\"overflow-hidden\" v-model=\"tabIndex\" :tabs=\"tabs\">\n      <template #tab=\"{ tab, selected }\">\n        <button\n          class=\"group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-gray-600 duration-300 ease-in-out hover:border-gray-400 hover:text-gray-900\"\n          :class=\"{ 'text-gray-900': selected }\"\n        >\n          <component v-if=\"tab.icon\" :is=\"tab.icon\" class=\"h-5\" />\n          {{ __(tab.label) }}\n          <Badge\n            class=\"group-hover:bg-gray-900\"\n            :class=\"[selected ? 'bg-gray-900' : 'bg-gray-600']\"\n            variant=\"solid\"\n            theme=\"gray\"\n            size=\"sm\"\n          >\n            {{ tab.count }}\n          </Badge>\n        </button>\n      </template>\n      <template #default=\"{ tab }\">\n        <DealsListView\n          v-if=\"tab.label === 'Deals' && rows.length\"\n          class=\"mt-4\"\n          :rows=\"rows\"\n          :columns=\"columns\"\n          :options=\"{ selectable: false, showTooltip: false }\"\n        />\n        <div\n          v-if=\"!rows.length\"\n          class=\"grid flex-1 place-items-center text-xl font-medium text-gray-500\"\n        >\n          <div class=\"flex flex-col items-center justify-center space-y-3\">\n            <component :is=\"tab.icon\" class=\"!h-10 !w-10\" />\n            <div>{{ __('No {0} Found', [__(tab.label)]) }}</div>\n          </div>\n        </div>\n      </template>\n    </Tabs>\n  </div>\n  <ContactModal\n    v-model=\"showContactModal\"\n    v-model:quickEntry=\"showQuickEntryModal\"\n    :contact=\"contact\"\n    :options=\"{ detailMode }\"\n  />\n  <QuickEntryModal\n    v-if=\"showQuickEntryModal\"\n    v-model=\"showQuickEntryModal\"\n    doctype=\"Contact\"\n  />\n</template>\n\n<script setup>\nimport Icon from '@/components/Icon.vue'\nimport Dropdown from '@/components/frappe-ui/Dropdown.vue'\nimport LayoutHeader from '@/components/LayoutHeader.vue'\nimport Email2Icon from '@/components/Icons/Email2Icon.vue'\nimport PhoneIcon from '@/components/Icons/PhoneIcon.vue'\nimport EditIcon from '@/components/Icons/EditIcon.vue'\nimport CameraIcon from '@/components/Icons/CameraIcon.vue'\nimport DealsIcon from '@/components/Icons/DealsIcon.vue'\nimport DealsListView from '@/components/ListViews/DealsListView.vue'\nimport ContactModal from '@/components/Modals/ContactModal.vue'\nimport QuickEntryModal from '@/components/Settings/QuickEntryModal.vue'\nimport {\n  dateFormat,\n  dateTooltipFormat,\n  timeAgo,\n  formatNumberIntoCurrency,\n} from '@/utils'\nimport { getView } from '@/utils/view'\nimport { globalStore } from '@/stores/global.js'\nimport { usersStore } from '@/stores/users.js'\nimport { organizationsStore } from '@/stores/organizations.js'\nimport { statusesStore } from '@/stores/statuses'\nimport { callEnabled } from '@/composables/settings'\nimport {\n  Breadcrumbs,\n  Avatar,\n  FileUploader,\n  Tooltip,\n  Tabs,\n  call,\n  createResource,\n  usePageMeta,\n} from 'frappe-ui'\nimport { ref, computed, h } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\n\nconst { $dialog, makeCall } = globalStore()\n\nconst { getUser } = usersStore()\nconst { getOrganization } = organizationsStore()\nconst { getDealStatus } = statusesStore()\n\nconst props = defineProps({\n  contactId: {\n    type: String,\n    required: true,\n  },\n})\n\nconst route = useRoute()\nconst router = useRouter()\n\nconst showContactModal = ref(false)\nconst showQuickEntryModal = ref(false)\nconst detailMode = ref(false)\n\nconst contact = createResource({\n  url: 'crm.api.contact.get_contact',\n  cache: ['contact', props.contactId],\n  params: {\n    name: props.contactId,\n  },\n  auto: true,\n  transform: (data) => {\n    return {\n      ...data,\n      actual_mobile_no: data.mobile_no,\n      mobile_no: data.mobile_no,\n    }\n  },\n})\n\nconst breadcrumbs = computed(() => {\n  let items = [{ label: __('Contacts'), route: { name: 'Contacts' } }]\n\n  if (route.query.view || route.query.viewType) {\n    let view = getView(route.query.view, route.query.viewType, 'Contact')\n    if (view) {\n      items.push({\n        label: __(view.label),\n        icon: view.icon,\n        route: {\n          name: 'Contacts',\n          params: { viewType: route.query.viewType },\n          query: { view: route.query.view },\n        },\n      })\n    }\n  }\n\n  items.push({\n    label: contact.data?.full_name,\n    route: { name: 'Contact', params: { contactId: props.contactId } },\n  })\n  return items\n})\n\nusePageMeta(() => {\n  return {\n    title: contact.data?.full_name || contact.data?.name,\n  }\n})\n\nfunction validateFile(file) {\n  let extn = file.name.split('.').pop().toLowerCase()\n  if (!['png', 'jpg', 'jpeg'].includes(extn)) {\n    return __('Only PNG and JPG images are allowed')\n  }\n}\n\nasync function changeContactImage(file) {\n  await call('frappe.client.set_value', {\n    doctype: 'Contact',\n    name: props.contactId,\n    fieldname: 'image',\n    value: file?.file_url || '',\n  })\n  contact.reload()\n}\n\nasync function deleteContact() {\n  $dialog({\n    title: __('Delete contact'),\n    message: __('Are you sure you want to delete this contact?'),\n    actions: [\n      {\n        label: __('Delete'),\n        theme: 'red',\n        variant: 'solid',\n        async onClick(close) {\n          await call('frappe.client.delete', {\n            doctype: 'Contact',\n            name: props.contactId,\n          })\n          close()\n          router.push({ name: 'Contacts' })\n        },\n      },\n    ],\n  })\n}\n\nconst tabIndex = ref(0)\nconst tabs = [\n  {\n    label: 'Deals',\n    icon: h(DealsIcon, { class: 'h-4 w-4' }),\n    count: computed(() => deals.data?.length),\n  },\n]\n\nconst deals = createResource({\n  url: 'crm.api.contact.get_linked_deals',\n  cache: ['deals', props.contactId],\n  params: {\n    contact: props.contactId,\n  },\n  auto: true,\n})\n\nconst rows = computed(() => {\n  if (!deals.data || deals.data == []) return []\n\n  return deals.data.map((row) => getDealRowObject(row))\n})\n\nconst columns = computed(() => dealColumns)\n\nfunction getDealRowObject(deal) {\n  return {\n    name: deal.name,\n    organization: {\n      label: deal.organization,\n      logo: getOrganization(deal.organization)?.organization_logo,\n    },\n    annual_revenue: formatNumberIntoCurrency(\n      deal.annual_revenue,\n      deal.currency,\n    ),\n    status: {\n      label: deal.status,\n      color: getDealStatus(deal.status)?.iconColorClass,\n    },\n    email: deal.email,\n    mobile_no: deal.mobile_no,\n    deal_owner: {\n      label: deal.deal_owner && getUser(deal.deal_owner).full_name,\n      ...(deal.deal_owner && getUser(deal.deal_owner)),\n    },\n    modified: {\n      label: dateFormat(deal.modified, dateTooltipFormat),\n      timeAgo: __(timeAgo(deal.modified)),\n    },\n  }\n}\n\nconst dealColumns = [\n  {\n    label: __('Organization'),\n    key: 'organization',\n    width: '11rem',\n  },\n  {\n    label: __('Amount'),\n    key: 'annual_revenue',\n    width: '9rem',\n  },\n  {\n    label: __('Status'),\n    key: 'status',\n    width: '10rem',\n  },\n  {\n    label: __('Email'),\n    key: 'email',\n    width: '12rem',\n  },\n  {\n    label: __('Mobile no'),\n    key: 'mobile_no',\n    width: '11rem',\n  },\n  {\n    label: __('Deal owner'),\n    key: 'deal_owner',\n    width: '10rem',\n  },\n  {\n    label: __('Last modified'),\n    key: 'modified',\n    width: '8rem',\n  },\n]\n</script>\n\n<style scoped>\n:deep(.form-control input),\n:deep(.form-control select),\n:deep(.form-control button) {\n  border-color: transparent;\n  background: white;\n}\n\n:deep(.form-control button) {\n  gap: 0;\n}\n\n:deep(.form-control button > div) {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n:deep(.form-control button svg) {\n  color: white;\n  width: 0;\n}\n\n:deep(:has(> .dropdown-button)) {\n  width: 100%;\n}\n\n:deep(.dropdown-button > button > span) {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n</style>\n"],"names":["$dialog","makeCall","globalStore","getUser","usersStore","getOrganization","organizationsStore","getDealStatus","statusesStore","props","__props","route","useRoute","router","useRouter","showContactModal","ref","showQuickEntryModal","detailMode","contact","createResource","data","breadcrumbs","computed","items","view","getView","_a","usePageMeta","_b","validateFile","file","extn","changeContactImage","call","deleteContact","close","tabIndex","tabs","h","DealsIcon","deals","rows","row","getDealRowObject","columns","dealColumns","deal","formatNumberIntoCurrency","dateFormat","dateTooltipFormat","timeAgo"],"mappings":"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"}